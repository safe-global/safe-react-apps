{"ast":null,"code":"import BN from 'bn.js';\nimport hash from 'hash.js';\nvar commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\nfunction getDefaultExportFromCjs(x) {\n  return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nfunction createCommonjsModule(fn, basedir, module) {\n  return module = {\n    path: basedir,\n    exports: {},\n    require: function (path, base) {\n      return commonjsRequire(path, base === undefined || base === null ? module.path : base);\n    }\n  }, fn(module, module.exports), module.exports;\n}\n\nfunction getDefaultExportFromNamespaceIfPresent(n) {\n  return n && Object.prototype.hasOwnProperty.call(n, 'default') ? n['default'] : n;\n}\n\nfunction getDefaultExportFromNamespaceIfNotNamed(n) {\n  return n && Object.prototype.hasOwnProperty.call(n, 'default') && Object.keys(n).length === 1 ? n['default'] : n;\n}\n\nfunction getAugmentedNamespace(n) {\n  if (n.__esModule) return n;\n  var a = Object.defineProperty({}, '__esModule', {\n    value: true\n  });\n  Object.keys(n).forEach(function (k) {\n    var d = Object.getOwnPropertyDescriptor(n, k);\n    Object.defineProperty(a, k, d.get ? d : {\n      enumerable: true,\n      get: function () {\n        return n[k];\n      }\n    });\n  });\n  return a;\n}\n\nfunction commonjsRequire() {\n  throw new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs');\n}\n\nvar minimalisticAssert = assert;\n\nfunction assert(val, msg) {\n  if (!val) throw new Error(msg || 'Assertion failed');\n}\n\nassert.equal = function assertEqual(l, r, msg) {\n  if (l != r) throw new Error(msg || 'Assertion failed: ' + l + ' != ' + r);\n};\n\nvar utils_1 = createCommonjsModule(function (module, exports) {\n  'use strict';\n\n  var utils = exports;\n\n  function toArray(msg, enc) {\n    if (Array.isArray(msg)) return msg.slice();\n    if (!msg) return [];\n    var res = [];\n\n    if (typeof msg !== 'string') {\n      for (var i = 0; i < msg.length; i++) res[i] = msg[i] | 0;\n\n      return res;\n    }\n\n    if (enc === 'hex') {\n      msg = msg.replace(/[^a-z0-9]+/ig, '');\n      if (msg.length % 2 !== 0) msg = '0' + msg;\n\n      for (var i = 0; i < msg.length; i += 2) res.push(parseInt(msg[i] + msg[i + 1], 16));\n    } else {\n      for (var i = 0; i < msg.length; i++) {\n        var c = msg.charCodeAt(i);\n        var hi = c >> 8;\n        var lo = c & 0xff;\n        if (hi) res.push(hi, lo);else res.push(lo);\n      }\n    }\n\n    return res;\n  }\n\n  utils.toArray = toArray;\n\n  function zero2(word) {\n    if (word.length === 1) return '0' + word;else return word;\n  }\n\n  utils.zero2 = zero2;\n\n  function toHex(msg) {\n    var res = '';\n\n    for (var i = 0; i < msg.length; i++) res += zero2(msg[i].toString(16));\n\n    return res;\n  }\n\n  utils.toHex = toHex;\n\n  utils.encode = function encode(arr, enc) {\n    if (enc === 'hex') return toHex(arr);else return arr;\n  };\n});\nvar utils_1$1 = createCommonjsModule(function (module, exports) {\n  'use strict';\n\n  var utils = exports;\n  utils.assert = minimalisticAssert;\n  utils.toArray = utils_1.toArray;\n  utils.zero2 = utils_1.zero2;\n  utils.toHex = utils_1.toHex;\n  utils.encode = utils_1.encode; // Represent num in a w-NAF form\n\n  function getNAF(num, w, bits) {\n    var naf = new Array(Math.max(num.bitLength(), bits) + 1);\n    naf.fill(0);\n    var ws = 1 << w + 1;\n    var k = num.clone();\n\n    for (var i = 0; i < naf.length; i++) {\n      var z;\n      var mod = k.andln(ws - 1);\n\n      if (k.isOdd()) {\n        if (mod > (ws >> 1) - 1) z = (ws >> 1) - mod;else z = mod;\n        k.isubn(z);\n      } else {\n        z = 0;\n      }\n\n      naf[i] = z;\n      k.iushrn(1);\n    }\n\n    return naf;\n  }\n\n  utils.getNAF = getNAF; // Represent k1, k2 in a Joint Sparse Form\n\n  function getJSF(k1, k2) {\n    var jsf = [[], []];\n    k1 = k1.clone();\n    k2 = k2.clone();\n    var d1 = 0;\n    var d2 = 0;\n\n    while (k1.cmpn(-d1) > 0 || k2.cmpn(-d2) > 0) {\n      // First phase\n      var m14 = k1.andln(3) + d1 & 3;\n      var m24 = k2.andln(3) + d2 & 3;\n      if (m14 === 3) m14 = -1;\n      if (m24 === 3) m24 = -1;\n      var u1;\n\n      if ((m14 & 1) === 0) {\n        u1 = 0;\n      } else {\n        var m8 = k1.andln(7) + d1 & 7;\n        if ((m8 === 3 || m8 === 5) && m24 === 2) u1 = -m14;else u1 = m14;\n      }\n\n      jsf[0].push(u1);\n      var u2;\n\n      if ((m24 & 1) === 0) {\n        u2 = 0;\n      } else {\n        var m8 = k2.andln(7) + d2 & 7;\n        if ((m8 === 3 || m8 === 5) && m14 === 2) u2 = -m24;else u2 = m24;\n      }\n\n      jsf[1].push(u2); // Second phase\n\n      if (2 * d1 === u1 + 1) d1 = 1 - d1;\n      if (2 * d2 === u2 + 1) d2 = 1 - d2;\n      k1.iushrn(1);\n      k2.iushrn(1);\n    }\n\n    return jsf;\n  }\n\n  utils.getJSF = getJSF;\n\n  function cachedProperty(obj, name, computer) {\n    var key = '_' + name;\n\n    obj.prototype[name] = function cachedProperty() {\n      return this[key] !== undefined ? this[key] : this[key] = computer.call(this);\n    };\n  }\n\n  utils.cachedProperty = cachedProperty;\n\n  function parseBytes(bytes) {\n    return typeof bytes === 'string' ? utils.toArray(bytes, 'hex') : bytes;\n  }\n\n  utils.parseBytes = parseBytes;\n\n  function intFromLE(bytes) {\n    return new BN(bytes, 'hex', 'le');\n  }\n\n  utils.intFromLE = intFromLE;\n});\n'use strict';\n\nvar getNAF = utils_1$1.getNAF;\nvar getJSF = utils_1$1.getJSF;\nvar assert$1 = utils_1$1.assert;\n\nfunction BaseCurve(type, conf) {\n  this.type = type;\n  this.p = new BN(conf.p, 16); // Use Montgomery, when there is no fast reduction for the prime\n\n  this.red = conf.prime ? BN.red(conf.prime) : BN.mont(this.p); // Useful for many curves\n\n  this.zero = new BN(0).toRed(this.red);\n  this.one = new BN(1).toRed(this.red);\n  this.two = new BN(2).toRed(this.red); // Curve configuration, optional\n\n  this.n = conf.n && new BN(conf.n, 16);\n  this.g = conf.g && this.pointFromJSON(conf.g, conf.gRed); // Temporary arrays\n\n  this._wnafT1 = new Array(4);\n  this._wnafT2 = new Array(4);\n  this._wnafT3 = new Array(4);\n  this._wnafT4 = new Array(4);\n  this._bitLength = this.n ? this.n.bitLength() : 0; // Generalized Greg Maxwell's trick\n\n  var adjustCount = this.n && this.p.div(this.n);\n\n  if (!adjustCount || adjustCount.cmpn(100) > 0) {\n    this.redN = null;\n  } else {\n    this._maxwellTrick = true;\n    this.redN = this.n.toRed(this.red);\n  }\n}\n\nvar base = BaseCurve;\n\nBaseCurve.prototype.point = function point() {\n  throw new Error('Not implemented');\n};\n\nBaseCurve.prototype.validate = function validate() {\n  throw new Error('Not implemented');\n};\n\nBaseCurve.prototype._fixedNafMul = function _fixedNafMul(p, k) {\n  assert$1(p.precomputed);\n\n  var doubles = p._getDoubles();\n\n  var naf = getNAF(k, 1, this._bitLength);\n  var I = (1 << doubles.step + 1) - (doubles.step % 2 === 0 ? 2 : 1);\n  I /= 3; // Translate into more windowed form\n\n  var repr = [];\n\n  for (var j = 0; j < naf.length; j += doubles.step) {\n    var nafW = 0;\n\n    for (var k = j + doubles.step - 1; k >= j; k--) nafW = (nafW << 1) + naf[k];\n\n    repr.push(nafW);\n  }\n\n  var a = this.jpoint(null, null, null);\n  var b = this.jpoint(null, null, null);\n\n  for (var i = I; i > 0; i--) {\n    for (var j = 0; j < repr.length; j++) {\n      var nafW = repr[j];\n      if (nafW === i) b = b.mixedAdd(doubles.points[j]);else if (nafW === -i) b = b.mixedAdd(doubles.points[j].neg());\n    }\n\n    a = a.add(b);\n  }\n\n  return a.toP();\n};\n\nBaseCurve.prototype._wnafMul = function _wnafMul(p, k) {\n  var w = 4; // Precompute window\n\n  var nafPoints = p._getNAFPoints(w);\n\n  w = nafPoints.wnd;\n  var wnd = nafPoints.points; // Get NAF form\n\n  var naf = getNAF(k, w, this._bitLength); // Add `this`*(N+1) for every w-NAF index\n\n  var acc = this.jpoint(null, null, null);\n\n  for (var i = naf.length - 1; i >= 0; i--) {\n    // Count zeroes\n    for (var k = 0; i >= 0 && naf[i] === 0; i--) k++;\n\n    if (i >= 0) k++;\n    acc = acc.dblp(k);\n    if (i < 0) break;\n    var z = naf[i];\n    assert$1(z !== 0);\n\n    if (p.type === 'affine') {\n      // J +- P\n      if (z > 0) acc = acc.mixedAdd(wnd[z - 1 >> 1]);else acc = acc.mixedAdd(wnd[-z - 1 >> 1].neg());\n    } else {\n      // J +- J\n      if (z > 0) acc = acc.add(wnd[z - 1 >> 1]);else acc = acc.add(wnd[-z - 1 >> 1].neg());\n    }\n  }\n\n  return p.type === 'affine' ? acc.toP() : acc;\n};\n\nBaseCurve.prototype._wnafMulAdd = function _wnafMulAdd(defW, points, coeffs, len, jacobianResult) {\n  var wndWidth = this._wnafT1;\n  var wnd = this._wnafT2;\n  var naf = this._wnafT3; // Fill all arrays\n\n  var max = 0;\n\n  for (var i = 0; i < len; i++) {\n    var p = points[i];\n\n    var nafPoints = p._getNAFPoints(defW);\n\n    wndWidth[i] = nafPoints.wnd;\n    wnd[i] = nafPoints.points;\n  } // Comb small window NAFs\n\n\n  for (var i = len - 1; i >= 1; i -= 2) {\n    var a = i - 1;\n    var b = i;\n\n    if (wndWidth[a] !== 1 || wndWidth[b] !== 1) {\n      naf[a] = getNAF(coeffs[a], wndWidth[a], this._bitLength);\n      naf[b] = getNAF(coeffs[b], wndWidth[b], this._bitLength);\n      max = Math.max(naf[a].length, max);\n      max = Math.max(naf[b].length, max);\n      continue;\n    }\n\n    var comb = [points[a],\n    /* 1 */\n    null,\n    /* 3 */\n    null,\n    /* 5 */\n    points[b]\n    /* 7 */\n    ]; // Try to avoid Projective points, if possible\n\n    if (points[a].y.cmp(points[b].y) === 0) {\n      comb[1] = points[a].add(points[b]);\n      comb[2] = points[a].toJ().mixedAdd(points[b].neg());\n    } else if (points[a].y.cmp(points[b].y.redNeg()) === 0) {\n      comb[1] = points[a].toJ().mixedAdd(points[b]);\n      comb[2] = points[a].add(points[b].neg());\n    } else {\n      comb[1] = points[a].toJ().mixedAdd(points[b]);\n      comb[2] = points[a].toJ().mixedAdd(points[b].neg());\n    }\n\n    var index = [-3,\n    /* -1 -1 */\n    -1,\n    /* -1 0 */\n    -5,\n    /* -1 1 */\n    -7,\n    /* 0 -1 */\n    0,\n    /* 0 0 */\n    7,\n    /* 0 1 */\n    5,\n    /* 1 -1 */\n    1,\n    /* 1 0 */\n    3\n    /* 1 1 */\n    ];\n    var jsf = getJSF(coeffs[a], coeffs[b]);\n    max = Math.max(jsf[0].length, max);\n    naf[a] = new Array(max);\n    naf[b] = new Array(max);\n\n    for (var j = 0; j < max; j++) {\n      var ja = jsf[0][j] | 0;\n      var jb = jsf[1][j] | 0;\n      naf[a][j] = index[(ja + 1) * 3 + (jb + 1)];\n      naf[b][j] = 0;\n      wnd[a] = comb;\n    }\n  }\n\n  var acc = this.jpoint(null, null, null);\n  var tmp = this._wnafT4;\n\n  for (var i = max; i >= 0; i--) {\n    var k = 0;\n\n    while (i >= 0) {\n      var zero = true;\n\n      for (var j = 0; j < len; j++) {\n        tmp[j] = naf[j][i] | 0;\n        if (tmp[j] !== 0) zero = false;\n      }\n\n      if (!zero) break;\n      k++;\n      i--;\n    }\n\n    if (i >= 0) k++;\n    acc = acc.dblp(k);\n    if (i < 0) break;\n\n    for (var j = 0; j < len; j++) {\n      var z = tmp[j];\n      var p;\n      if (z === 0) continue;else if (z > 0) p = wnd[j][z - 1 >> 1];else if (z < 0) p = wnd[j][-z - 1 >> 1].neg();\n      if (p.type === 'affine') acc = acc.mixedAdd(p);else acc = acc.add(p);\n    }\n  } // Zeroify references\n\n\n  for (var i = 0; i < len; i++) wnd[i] = null;\n\n  if (jacobianResult) return acc;else return acc.toP();\n};\n\nfunction BasePoint(curve, type) {\n  this.curve = curve;\n  this.type = type;\n  this.precomputed = null;\n}\n\nBaseCurve.BasePoint = BasePoint;\n\nBasePoint.prototype.eq = function eq()\n/*other*/\n{\n  throw new Error('Not implemented');\n};\n\nBasePoint.prototype.validate = function validate() {\n  return this.curve.validate(this);\n};\n\nBaseCurve.prototype.decodePoint = function decodePoint(bytes, enc) {\n  bytes = utils_1$1.toArray(bytes, enc);\n  var len = this.p.byteLength(); // uncompressed, hybrid-odd, hybrid-even\n\n  if ((bytes[0] === 0x04 || bytes[0] === 0x06 || bytes[0] === 0x07) && bytes.length - 1 === 2 * len) {\n    if (bytes[0] === 0x06) assert$1(bytes[bytes.length - 1] % 2 === 0);else if (bytes[0] === 0x07) assert$1(bytes[bytes.length - 1] % 2 === 1);\n    var res = this.point(bytes.slice(1, 1 + len), bytes.slice(1 + len, 1 + 2 * len));\n    return res;\n  } else if ((bytes[0] === 0x02 || bytes[0] === 0x03) && bytes.length - 1 === len) {\n    return this.pointFromX(bytes.slice(1, 1 + len), bytes[0] === 0x03);\n  }\n\n  throw new Error('Unknown point format');\n};\n\nBasePoint.prototype.encodeCompressed = function encodeCompressed(enc) {\n  return this.encode(enc, true);\n};\n\nBasePoint.prototype._encode = function _encode(compact) {\n  var len = this.curve.p.byteLength();\n  var x = this.getX().toArray('be', len);\n  if (compact) return [this.getY().isEven() ? 0x02 : 0x03].concat(x);\n  return [0x04].concat(x, this.getY().toArray('be', len));\n};\n\nBasePoint.prototype.encode = function encode(enc, compact) {\n  return utils_1$1.encode(this._encode(compact), enc);\n};\n\nBasePoint.prototype.precompute = function precompute(power) {\n  if (this.precomputed) return this;\n  var precomputed = {\n    doubles: null,\n    naf: null,\n    beta: null\n  };\n  precomputed.naf = this._getNAFPoints(8);\n  precomputed.doubles = this._getDoubles(4, power);\n  precomputed.beta = this._getBeta();\n  this.precomputed = precomputed;\n  return this;\n};\n\nBasePoint.prototype._hasDoubles = function _hasDoubles(k) {\n  if (!this.precomputed) return false;\n  var doubles = this.precomputed.doubles;\n  if (!doubles) return false;\n  return doubles.points.length >= Math.ceil((k.bitLength() + 1) / doubles.step);\n};\n\nBasePoint.prototype._getDoubles = function _getDoubles(step, power) {\n  if (this.precomputed && this.precomputed.doubles) return this.precomputed.doubles;\n  var doubles = [this];\n  var acc = this;\n\n  for (var i = 0; i < power; i += step) {\n    for (var j = 0; j < step; j++) acc = acc.dbl();\n\n    doubles.push(acc);\n  }\n\n  return {\n    step: step,\n    points: doubles\n  };\n};\n\nBasePoint.prototype._getNAFPoints = function _getNAFPoints(wnd) {\n  if (this.precomputed && this.precomputed.naf) return this.precomputed.naf;\n  var res = [this];\n  var max = (1 << wnd) - 1;\n  var dbl = max === 1 ? null : this.dbl();\n\n  for (var i = 1; i < max; i++) res[i] = res[i - 1].add(dbl);\n\n  return {\n    wnd: wnd,\n    points: res\n  };\n};\n\nBasePoint.prototype._getBeta = function _getBeta() {\n  return null;\n};\n\nBasePoint.prototype.dblp = function dblp(k) {\n  var r = this;\n\n  for (var i = 0; i < k; i++) r = r.dbl();\n\n  return r;\n};\n\nvar inherits_browser = createCommonjsModule(function (module) {\n  if (typeof Object.create === 'function') {\n    // implementation from standard node.js 'util' module\n    module.exports = function inherits(ctor, superCtor) {\n      if (superCtor) {\n        ctor.super_ = superCtor;\n        ctor.prototype = Object.create(superCtor.prototype, {\n          constructor: {\n            value: ctor,\n            enumerable: false,\n            writable: true,\n            configurable: true\n          }\n        });\n      }\n    };\n  } else {\n    // old school shim for old browsers\n    module.exports = function inherits(ctor, superCtor) {\n      if (superCtor) {\n        ctor.super_ = superCtor;\n\n        var TempCtor = function () {};\n\n        TempCtor.prototype = superCtor.prototype;\n        ctor.prototype = new TempCtor();\n        ctor.prototype.constructor = ctor;\n      }\n    };\n  }\n});\n'use strict';\n\nvar assert$2 = utils_1$1.assert;\n\nfunction ShortCurve(conf) {\n  base.call(this, 'short', conf);\n  this.a = new BN(conf.a, 16).toRed(this.red);\n  this.b = new BN(conf.b, 16).toRed(this.red);\n  this.tinv = this.two.redInvm();\n  this.zeroA = this.a.fromRed().cmpn(0) === 0;\n  this.threeA = this.a.fromRed().sub(this.p).cmpn(-3) === 0; // If the curve is endomorphic, precalculate beta and lambda\n\n  this.endo = this._getEndomorphism(conf);\n  this._endoWnafT1 = new Array(4);\n  this._endoWnafT2 = new Array(4);\n}\n\ninherits_browser(ShortCurve, base);\nvar short_1 = ShortCurve;\n\nShortCurve.prototype._getEndomorphism = function _getEndomorphism(conf) {\n  // No efficient endomorphism\n  if (!this.zeroA || !this.g || !this.n || this.p.modn(3) !== 1) return; // Compute beta and lambda, that lambda * P = (beta * Px; Py)\n\n  var beta;\n  var lambda;\n\n  if (conf.beta) {\n    beta = new BN(conf.beta, 16).toRed(this.red);\n  } else {\n    var betas = this._getEndoRoots(this.p); // Choose the smallest beta\n\n\n    beta = betas[0].cmp(betas[1]) < 0 ? betas[0] : betas[1];\n    beta = beta.toRed(this.red);\n  }\n\n  if (conf.lambda) {\n    lambda = new BN(conf.lambda, 16);\n  } else {\n    // Choose the lambda that is matching selected beta\n    var lambdas = this._getEndoRoots(this.n);\n\n    if (this.g.mul(lambdas[0]).x.cmp(this.g.x.redMul(beta)) === 0) {\n      lambda = lambdas[0];\n    } else {\n      lambda = lambdas[1];\n      assert$2(this.g.mul(lambda).x.cmp(this.g.x.redMul(beta)) === 0);\n    }\n  } // Get basis vectors, used for balanced length-two representation\n\n\n  var basis;\n\n  if (conf.basis) {\n    basis = conf.basis.map(function (vec) {\n      return {\n        a: new BN(vec.a, 16),\n        b: new BN(vec.b, 16)\n      };\n    });\n  } else {\n    basis = this._getEndoBasis(lambda);\n  }\n\n  return {\n    beta: beta,\n    lambda: lambda,\n    basis: basis\n  };\n};\n\nShortCurve.prototype._getEndoRoots = function _getEndoRoots(num) {\n  // Find roots of for x^2 + x + 1 in F\n  // Root = (-1 +- Sqrt(-3)) / 2\n  //\n  var red = num === this.p ? this.red : BN.mont(num);\n  var tinv = new BN(2).toRed(red).redInvm();\n  var ntinv = tinv.redNeg();\n  var s = new BN(3).toRed(red).redNeg().redSqrt().redMul(tinv);\n  var l1 = ntinv.redAdd(s).fromRed();\n  var l2 = ntinv.redSub(s).fromRed();\n  return [l1, l2];\n};\n\nShortCurve.prototype._getEndoBasis = function _getEndoBasis(lambda) {\n  // aprxSqrt >= sqrt(this.n)\n  var aprxSqrt = this.n.ushrn(Math.floor(this.n.bitLength() / 2)); // 3.74\n  // Run EGCD, until r(L + 1) < aprxSqrt\n\n  var u = lambda;\n  var v = this.n.clone();\n  var x1 = new BN(1);\n  var y1 = new BN(0);\n  var x2 = new BN(0);\n  var y2 = new BN(1); // NOTE: all vectors are roots of: a + b * lambda = 0 (mod n)\n\n  var a0;\n  var b0; // First vector\n\n  var a1;\n  var b1; // Second vector\n\n  var a2;\n  var b2;\n  var prevR;\n  var i = 0;\n  var r;\n  var x;\n\n  while (u.cmpn(0) !== 0) {\n    var q = v.div(u);\n    r = v.sub(q.mul(u));\n    x = x2.sub(q.mul(x1));\n    var y = y2.sub(q.mul(y1));\n\n    if (!a1 && r.cmp(aprxSqrt) < 0) {\n      a0 = prevR.neg();\n      b0 = x1;\n      a1 = r.neg();\n      b1 = x;\n    } else if (a1 && ++i === 2) {\n      break;\n    }\n\n    prevR = r;\n    v = u;\n    u = r;\n    x2 = x1;\n    x1 = x;\n    y2 = y1;\n    y1 = y;\n  }\n\n  a2 = r.neg();\n  b2 = x;\n  var len1 = a1.sqr().add(b1.sqr());\n  var len2 = a2.sqr().add(b2.sqr());\n\n  if (len2.cmp(len1) >= 0) {\n    a2 = a0;\n    b2 = b0;\n  } // Normalize signs\n\n\n  if (a1.negative) {\n    a1 = a1.neg();\n    b1 = b1.neg();\n  }\n\n  if (a2.negative) {\n    a2 = a2.neg();\n    b2 = b2.neg();\n  }\n\n  return [{\n    a: a1,\n    b: b1\n  }, {\n    a: a2,\n    b: b2\n  }];\n};\n\nShortCurve.prototype._endoSplit = function _endoSplit(k) {\n  var basis = this.endo.basis;\n  var v1 = basis[0];\n  var v2 = basis[1];\n  var c1 = v2.b.mul(k).divRound(this.n);\n  var c2 = v1.b.neg().mul(k).divRound(this.n);\n  var p1 = c1.mul(v1.a);\n  var p2 = c2.mul(v2.a);\n  var q1 = c1.mul(v1.b);\n  var q2 = c2.mul(v2.b); // Calculate answer\n\n  var k1 = k.sub(p1).sub(p2);\n  var k2 = q1.add(q2).neg();\n  return {\n    k1: k1,\n    k2: k2\n  };\n};\n\nShortCurve.prototype.pointFromX = function pointFromX(x, odd) {\n  x = new BN(x, 16);\n  if (!x.red) x = x.toRed(this.red);\n  var y2 = x.redSqr().redMul(x).redIAdd(x.redMul(this.a)).redIAdd(this.b);\n  var y = y2.redSqrt();\n  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0) throw new Error('invalid point'); // XXX Is there any way to tell if the number is odd without converting it\n  // to non-red form?\n\n  var isOdd = y.fromRed().isOdd();\n  if (odd && !isOdd || !odd && isOdd) y = y.redNeg();\n  return this.point(x, y);\n};\n\nShortCurve.prototype.validate = function validate(point) {\n  if (point.inf) return true;\n  var x = point.x;\n  var y = point.y;\n  var ax = this.a.redMul(x);\n  var rhs = x.redSqr().redMul(x).redIAdd(ax).redIAdd(this.b);\n  return y.redSqr().redISub(rhs).cmpn(0) === 0;\n};\n\nShortCurve.prototype._endoWnafMulAdd = function _endoWnafMulAdd(points, coeffs, jacobianResult) {\n  var npoints = this._endoWnafT1;\n  var ncoeffs = this._endoWnafT2;\n\n  for (var i = 0; i < points.length; i++) {\n    var split = this._endoSplit(coeffs[i]);\n\n    var p = points[i];\n\n    var beta = p._getBeta();\n\n    if (split.k1.negative) {\n      split.k1.ineg();\n      p = p.neg(true);\n    }\n\n    if (split.k2.negative) {\n      split.k2.ineg();\n      beta = beta.neg(true);\n    }\n\n    npoints[i * 2] = p;\n    npoints[i * 2 + 1] = beta;\n    ncoeffs[i * 2] = split.k1;\n    ncoeffs[i * 2 + 1] = split.k2;\n  }\n\n  var res = this._wnafMulAdd(1, npoints, ncoeffs, i * 2, jacobianResult); // Clean-up references to points and coefficients\n\n\n  for (var j = 0; j < i * 2; j++) {\n    npoints[j] = null;\n    ncoeffs[j] = null;\n  }\n\n  return res;\n};\n\nfunction Point(curve, x, y, isRed) {\n  base.BasePoint.call(this, curve, 'affine');\n\n  if (x === null && y === null) {\n    this.x = null;\n    this.y = null;\n    this.inf = true;\n  } else {\n    this.x = new BN(x, 16);\n    this.y = new BN(y, 16); // Force redgomery representation when loading from JSON\n\n    if (isRed) {\n      this.x.forceRed(this.curve.red);\n      this.y.forceRed(this.curve.red);\n    }\n\n    if (!this.x.red) this.x = this.x.toRed(this.curve.red);\n    if (!this.y.red) this.y = this.y.toRed(this.curve.red);\n    this.inf = false;\n  }\n}\n\ninherits_browser(Point, base.BasePoint);\n\nShortCurve.prototype.point = function point(x, y, isRed) {\n  return new Point(this, x, y, isRed);\n};\n\nShortCurve.prototype.pointFromJSON = function pointFromJSON(obj, red) {\n  return Point.fromJSON(this, obj, red);\n};\n\nPoint.prototype._getBeta = function _getBeta() {\n  if (!this.curve.endo) return;\n  var pre = this.precomputed;\n  if (pre && pre.beta) return pre.beta;\n  var beta = this.curve.point(this.x.redMul(this.curve.endo.beta), this.y);\n\n  if (pre) {\n    var curve = this.curve;\n\n    var endoMul = function (p) {\n      return curve.point(p.x.redMul(curve.endo.beta), p.y);\n    };\n\n    pre.beta = beta;\n    beta.precomputed = {\n      beta: null,\n      naf: pre.naf && {\n        wnd: pre.naf.wnd,\n        points: pre.naf.points.map(endoMul)\n      },\n      doubles: pre.doubles && {\n        step: pre.doubles.step,\n        points: pre.doubles.points.map(endoMul)\n      }\n    };\n  }\n\n  return beta;\n};\n\nPoint.prototype.toJSON = function toJSON() {\n  if (!this.precomputed) return [this.x, this.y];\n  return [this.x, this.y, this.precomputed && {\n    doubles: this.precomputed.doubles && {\n      step: this.precomputed.doubles.step,\n      points: this.precomputed.doubles.points.slice(1)\n    },\n    naf: this.precomputed.naf && {\n      wnd: this.precomputed.naf.wnd,\n      points: this.precomputed.naf.points.slice(1)\n    }\n  }];\n};\n\nPoint.fromJSON = function fromJSON(curve, obj, red) {\n  if (typeof obj === 'string') obj = JSON.parse(obj);\n  var res = curve.point(obj[0], obj[1], red);\n  if (!obj[2]) return res;\n\n  function obj2point(obj) {\n    return curve.point(obj[0], obj[1], red);\n  }\n\n  var pre = obj[2];\n  res.precomputed = {\n    beta: null,\n    doubles: pre.doubles && {\n      step: pre.doubles.step,\n      points: [res].concat(pre.doubles.points.map(obj2point))\n    },\n    naf: pre.naf && {\n      wnd: pre.naf.wnd,\n      points: [res].concat(pre.naf.points.map(obj2point))\n    }\n  };\n  return res;\n};\n\nPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity()) return '<EC Point Infinity>';\n  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) + ' y: ' + this.y.fromRed().toString(16, 2) + '>';\n};\n\nPoint.prototype.isInfinity = function isInfinity() {\n  return this.inf;\n};\n\nPoint.prototype.add = function add(p) {\n  // O + P = P\n  if (this.inf) return p; // P + O = P\n\n  if (p.inf) return this; // P + P = 2P\n\n  if (this.eq(p)) return this.dbl(); // P + (-P) = O\n\n  if (this.neg().eq(p)) return this.curve.point(null, null); // P + Q = O\n\n  if (this.x.cmp(p.x) === 0) return this.curve.point(null, null);\n  var c = this.y.redSub(p.y);\n  if (c.cmpn(0) !== 0) c = c.redMul(this.x.redSub(p.x).redInvm());\n  var nx = c.redSqr().redISub(this.x).redISub(p.x);\n  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);\n  return this.curve.point(nx, ny);\n};\n\nPoint.prototype.dbl = function dbl() {\n  if (this.inf) return this; // 2P = O\n\n  var ys1 = this.y.redAdd(this.y);\n  if (ys1.cmpn(0) === 0) return this.curve.point(null, null);\n  var a = this.curve.a;\n  var x2 = this.x.redSqr();\n  var dyinv = ys1.redInvm();\n  var c = x2.redAdd(x2).redIAdd(x2).redIAdd(a).redMul(dyinv);\n  var nx = c.redSqr().redISub(this.x.redAdd(this.x));\n  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);\n  return this.curve.point(nx, ny);\n};\n\nPoint.prototype.getX = function getX() {\n  return this.x.fromRed();\n};\n\nPoint.prototype.getY = function getY() {\n  return this.y.fromRed();\n};\n\nPoint.prototype.mul = function mul(k) {\n  k = new BN(k, 16);\n  if (this.isInfinity()) return this;else if (this._hasDoubles(k)) return this.curve._fixedNafMul(this, k);else if (this.curve.endo) return this.curve._endoWnafMulAdd([this], [k]);else return this.curve._wnafMul(this, k);\n};\n\nPoint.prototype.mulAdd = function mulAdd(k1, p2, k2) {\n  var points = [this, p2];\n  var coeffs = [k1, k2];\n  if (this.curve.endo) return this.curve._endoWnafMulAdd(points, coeffs);else return this.curve._wnafMulAdd(1, points, coeffs, 2);\n};\n\nPoint.prototype.jmulAdd = function jmulAdd(k1, p2, k2) {\n  var points = [this, p2];\n  var coeffs = [k1, k2];\n  if (this.curve.endo) return this.curve._endoWnafMulAdd(points, coeffs, true);else return this.curve._wnafMulAdd(1, points, coeffs, 2, true);\n};\n\nPoint.prototype.eq = function eq(p) {\n  return this === p || this.inf === p.inf && (this.inf || this.x.cmp(p.x) === 0 && this.y.cmp(p.y) === 0);\n};\n\nPoint.prototype.neg = function neg(_precompute) {\n  if (this.inf) return this;\n  var res = this.curve.point(this.x, this.y.redNeg());\n\n  if (_precompute && this.precomputed) {\n    var pre = this.precomputed;\n\n    var negate = function (p) {\n      return p.neg();\n    };\n\n    res.precomputed = {\n      naf: pre.naf && {\n        wnd: pre.naf.wnd,\n        points: pre.naf.points.map(negate)\n      },\n      doubles: pre.doubles && {\n        step: pre.doubles.step,\n        points: pre.doubles.points.map(negate)\n      }\n    };\n  }\n\n  return res;\n};\n\nPoint.prototype.toJ = function toJ() {\n  if (this.inf) return this.curve.jpoint(null, null, null);\n  var res = this.curve.jpoint(this.x, this.y, this.curve.one);\n  return res;\n};\n\nfunction JPoint(curve, x, y, z) {\n  base.BasePoint.call(this, curve, 'jacobian');\n\n  if (x === null && y === null && z === null) {\n    this.x = this.curve.one;\n    this.y = this.curve.one;\n    this.z = new BN(0);\n  } else {\n    this.x = new BN(x, 16);\n    this.y = new BN(y, 16);\n    this.z = new BN(z, 16);\n  }\n\n  if (!this.x.red) this.x = this.x.toRed(this.curve.red);\n  if (!this.y.red) this.y = this.y.toRed(this.curve.red);\n  if (!this.z.red) this.z = this.z.toRed(this.curve.red);\n  this.zOne = this.z === this.curve.one;\n}\n\ninherits_browser(JPoint, base.BasePoint);\n\nShortCurve.prototype.jpoint = function jpoint(x, y, z) {\n  return new JPoint(this, x, y, z);\n};\n\nJPoint.prototype.toP = function toP() {\n  if (this.isInfinity()) return this.curve.point(null, null);\n  var zinv = this.z.redInvm();\n  var zinv2 = zinv.redSqr();\n  var ax = this.x.redMul(zinv2);\n  var ay = this.y.redMul(zinv2).redMul(zinv);\n  return this.curve.point(ax, ay);\n};\n\nJPoint.prototype.neg = function neg() {\n  return this.curve.jpoint(this.x, this.y.redNeg(), this.z);\n};\n\nJPoint.prototype.add = function add(p) {\n  // O + P = P\n  if (this.isInfinity()) return p; // P + O = P\n\n  if (p.isInfinity()) return this; // 12M + 4S + 7A\n\n  var pz2 = p.z.redSqr();\n  var z2 = this.z.redSqr();\n  var u1 = this.x.redMul(pz2);\n  var u2 = p.x.redMul(z2);\n  var s1 = this.y.redMul(pz2.redMul(p.z));\n  var s2 = p.y.redMul(z2.redMul(this.z));\n  var h = u1.redSub(u2);\n  var r = s1.redSub(s2);\n\n  if (h.cmpn(0) === 0) {\n    if (r.cmpn(0) !== 0) return this.curve.jpoint(null, null, null);else return this.dbl();\n  }\n\n  var h2 = h.redSqr();\n  var h3 = h2.redMul(h);\n  var v = u1.redMul(h2);\n  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);\n  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));\n  var nz = this.z.redMul(p.z).redMul(h);\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.mixedAdd = function mixedAdd(p) {\n  // O + P = P\n  if (this.isInfinity()) return p.toJ(); // P + O = P\n\n  if (p.isInfinity()) return this; // 8M + 3S + 7A\n\n  var z2 = this.z.redSqr();\n  var u1 = this.x;\n  var u2 = p.x.redMul(z2);\n  var s1 = this.y;\n  var s2 = p.y.redMul(z2).redMul(this.z);\n  var h = u1.redSub(u2);\n  var r = s1.redSub(s2);\n\n  if (h.cmpn(0) === 0) {\n    if (r.cmpn(0) !== 0) return this.curve.jpoint(null, null, null);else return this.dbl();\n  }\n\n  var h2 = h.redSqr();\n  var h3 = h2.redMul(h);\n  var v = u1.redMul(h2);\n  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);\n  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));\n  var nz = this.z.redMul(h);\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.dblp = function dblp(pow) {\n  if (pow === 0) return this;\n  if (this.isInfinity()) return this;\n  if (!pow) return this.dbl();\n\n  if (this.curve.zeroA || this.curve.threeA) {\n    var r = this;\n\n    for (var i = 0; i < pow; i++) r = r.dbl();\n\n    return r;\n  } // 1M + 2S + 1A + N * (4S + 5M + 8A)\n  // N = 1 => 6M + 6S + 9A\n\n\n  var a = this.curve.a;\n  var tinv = this.curve.tinv;\n  var jx = this.x;\n  var jy = this.y;\n  var jz = this.z;\n  var jz4 = jz.redSqr().redSqr(); // Reuse results\n\n  var jyd = jy.redAdd(jy);\n\n  for (var i = 0; i < pow; i++) {\n    var jx2 = jx.redSqr();\n    var jyd2 = jyd.redSqr();\n    var jyd4 = jyd2.redSqr();\n    var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));\n    var t1 = jx.redMul(jyd2);\n    var nx = c.redSqr().redISub(t1.redAdd(t1));\n    var t2 = t1.redISub(nx);\n    var dny = c.redMul(t2);\n    dny = dny.redIAdd(dny).redISub(jyd4);\n    var nz = jyd.redMul(jz);\n    if (i + 1 < pow) jz4 = jz4.redMul(jyd4);\n    jx = nx;\n    jz = nz;\n    jyd = dny;\n  }\n\n  return this.curve.jpoint(jx, jyd.redMul(tinv), jz);\n};\n\nJPoint.prototype.dbl = function dbl() {\n  if (this.isInfinity()) return this;\n  if (this.curve.zeroA) return this._zeroDbl();else if (this.curve.threeA) return this._threeDbl();else return this._dbl();\n};\n\nJPoint.prototype._zeroDbl = function _zeroDbl() {\n  var nx;\n  var ny;\n  var nz; // Z = 1\n\n  if (this.zOne) {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html\n    //     #doubling-mdbl-2007-bl\n    // 1M + 5S + 14A\n    // XX = X1^2\n    var xx = this.x.redSqr(); // YY = Y1^2\n\n    var yy = this.y.redSqr(); // YYYY = YY^2\n\n    var yyyy = yy.redSqr(); // S = 2 * ((X1 + YY)^2 - XX - YYYY)\n\n    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n    s = s.redIAdd(s); // M = 3 * XX + a; a = 0\n\n    var m = xx.redAdd(xx).redIAdd(xx); // T = M ^ 2 - 2*S\n\n    var t = m.redSqr().redISub(s).redISub(s); // 8 * YYYY\n\n    var yyyy8 = yyyy.redIAdd(yyyy);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    yyyy8 = yyyy8.redIAdd(yyyy8); // X3 = T\n\n    nx = t; // Y3 = M * (S - T) - 8 * YYYY\n\n    ny = m.redMul(s.redISub(t)).redISub(yyyy8); // Z3 = 2*Y1\n\n    nz = this.y.redAdd(this.y);\n  } else {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html\n    //     #doubling-dbl-2009-l\n    // 2M + 5S + 13A\n    // A = X1^2\n    var a = this.x.redSqr(); // B = Y1^2\n\n    var b = this.y.redSqr(); // C = B^2\n\n    var c = b.redSqr(); // D = 2 * ((X1 + B)^2 - A - C)\n\n    var d = this.x.redAdd(b).redSqr().redISub(a).redISub(c);\n    d = d.redIAdd(d); // E = 3 * A\n\n    var e = a.redAdd(a).redIAdd(a); // F = E^2\n\n    var f = e.redSqr(); // 8 * C\n\n    var c8 = c.redIAdd(c);\n    c8 = c8.redIAdd(c8);\n    c8 = c8.redIAdd(c8); // X3 = F - 2 * D\n\n    nx = f.redISub(d).redISub(d); // Y3 = E * (D - X3) - 8 * C\n\n    ny = e.redMul(d.redISub(nx)).redISub(c8); // Z3 = 2 * Y1 * Z1\n\n    nz = this.y.redMul(this.z);\n    nz = nz.redIAdd(nz);\n  }\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype._threeDbl = function _threeDbl() {\n  var nx;\n  var ny;\n  var nz; // Z = 1\n\n  if (this.zOne) {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html\n    //     #doubling-mdbl-2007-bl\n    // 1M + 5S + 15A\n    // XX = X1^2\n    var xx = this.x.redSqr(); // YY = Y1^2\n\n    var yy = this.y.redSqr(); // YYYY = YY^2\n\n    var yyyy = yy.redSqr(); // S = 2 * ((X1 + YY)^2 - XX - YYYY)\n\n    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n    s = s.redIAdd(s); // M = 3 * XX + a\n\n    var m = xx.redAdd(xx).redIAdd(xx).redIAdd(this.curve.a); // T = M^2 - 2 * S\n\n    var t = m.redSqr().redISub(s).redISub(s); // X3 = T\n\n    nx = t; // Y3 = M * (S - T) - 8 * YYYY\n\n    var yyyy8 = yyyy.redIAdd(yyyy);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    ny = m.redMul(s.redISub(t)).redISub(yyyy8); // Z3 = 2 * Y1\n\n    nz = this.y.redAdd(this.y);\n  } else {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html#doubling-dbl-2001-b\n    // 3M + 5S\n    // delta = Z1^2\n    var delta = this.z.redSqr(); // gamma = Y1^2\n\n    var gamma = this.y.redSqr(); // beta = X1 * gamma\n\n    var beta = this.x.redMul(gamma); // alpha = 3 * (X1 - delta) * (X1 + delta)\n\n    var alpha = this.x.redSub(delta).redMul(this.x.redAdd(delta));\n    alpha = alpha.redAdd(alpha).redIAdd(alpha); // X3 = alpha^2 - 8 * beta\n\n    var beta4 = beta.redIAdd(beta);\n    beta4 = beta4.redIAdd(beta4);\n    var beta8 = beta4.redAdd(beta4);\n    nx = alpha.redSqr().redISub(beta8); // Z3 = (Y1 + Z1)^2 - gamma - delta\n\n    nz = this.y.redAdd(this.z).redSqr().redISub(gamma).redISub(delta); // Y3 = alpha * (4 * beta - X3) - 8 * gamma^2\n\n    var ggamma8 = gamma.redSqr();\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ny = alpha.redMul(beta4.redISub(nx)).redISub(ggamma8);\n  }\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype._dbl = function _dbl() {\n  var a = this.curve.a; // 4M + 6S + 10A\n\n  var jx = this.x;\n  var jy = this.y;\n  var jz = this.z;\n  var jz4 = jz.redSqr().redSqr();\n  var jx2 = jx.redSqr();\n  var jy2 = jy.redSqr();\n  var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));\n  var jxd4 = jx.redAdd(jx);\n  jxd4 = jxd4.redIAdd(jxd4);\n  var t1 = jxd4.redMul(jy2);\n  var nx = c.redSqr().redISub(t1.redAdd(t1));\n  var t2 = t1.redISub(nx);\n  var jyd8 = jy2.redSqr();\n  jyd8 = jyd8.redIAdd(jyd8);\n  jyd8 = jyd8.redIAdd(jyd8);\n  jyd8 = jyd8.redIAdd(jyd8);\n  var ny = c.redMul(t2).redISub(jyd8);\n  var nz = jy.redAdd(jy).redMul(jz);\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.trpl = function trpl() {\n  if (!this.curve.zeroA) return this.dbl().add(this); // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#tripling-tpl-2007-bl\n  // 5M + 10S + ...\n  // XX = X1^2\n\n  var xx = this.x.redSqr(); // YY = Y1^2\n\n  var yy = this.y.redSqr(); // ZZ = Z1^2\n\n  var zz = this.z.redSqr(); // YYYY = YY^2\n\n  var yyyy = yy.redSqr(); // M = 3 * XX + a * ZZ2; a = 0\n\n  var m = xx.redAdd(xx).redIAdd(xx); // MM = M^2\n\n  var mm = m.redSqr(); // E = 6 * ((X1 + YY)^2 - XX - YYYY) - MM\n\n  var e = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n  e = e.redIAdd(e);\n  e = e.redAdd(e).redIAdd(e);\n  e = e.redISub(mm); // EE = E^2\n\n  var ee = e.redSqr(); // T = 16*YYYY\n\n  var t = yyyy.redIAdd(yyyy);\n  t = t.redIAdd(t);\n  t = t.redIAdd(t);\n  t = t.redIAdd(t); // U = (M + E)^2 - MM - EE - T\n\n  var u = m.redIAdd(e).redSqr().redISub(mm).redISub(ee).redISub(t); // X3 = 4 * (X1 * EE - 4 * YY * U)\n\n  var yyu4 = yy.redMul(u);\n  yyu4 = yyu4.redIAdd(yyu4);\n  yyu4 = yyu4.redIAdd(yyu4);\n  var nx = this.x.redMul(ee).redISub(yyu4);\n  nx = nx.redIAdd(nx);\n  nx = nx.redIAdd(nx); // Y3 = 8 * Y1 * (U * (T - U) - E * EE)\n\n  var ny = this.y.redMul(u.redMul(t.redISub(u)).redISub(e.redMul(ee)));\n  ny = ny.redIAdd(ny);\n  ny = ny.redIAdd(ny);\n  ny = ny.redIAdd(ny); // Z3 = (Z1 + E)^2 - ZZ - EE\n\n  var nz = this.z.redAdd(e).redSqr().redISub(zz).redISub(ee);\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.mul = function mul(k, kbase) {\n  k = new BN(k, kbase);\n  return this.curve._wnafMul(this, k);\n};\n\nJPoint.prototype.eq = function eq(p) {\n  if (p.type === 'affine') return this.eq(p.toJ());\n  if (this === p) return true; // x1 * z2^2 == x2 * z1^2\n\n  var z2 = this.z.redSqr();\n  var pz2 = p.z.redSqr();\n  if (this.x.redMul(pz2).redISub(p.x.redMul(z2)).cmpn(0) !== 0) return false; // y1 * z2^3 == y2 * z1^3\n\n  var z3 = z2.redMul(this.z);\n  var pz3 = pz2.redMul(p.z);\n  return this.y.redMul(pz3).redISub(p.y.redMul(z3)).cmpn(0) === 0;\n};\n\nJPoint.prototype.eqXToP = function eqXToP(x) {\n  var zs = this.z.redSqr();\n  var rx = x.toRed(this.curve.red).redMul(zs);\n  if (this.x.cmp(rx) === 0) return true;\n  var xc = x.clone();\n  var t = this.curve.redN.redMul(zs);\n\n  for (;;) {\n    xc.iadd(this.curve.n);\n    if (xc.cmp(this.curve.p) >= 0) return false;\n    rx.redIAdd(t);\n    if (this.x.cmp(rx) === 0) return true;\n  }\n};\n\nJPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity()) return '<EC JPoint Infinity>';\n  return '<EC JPoint x: ' + this.x.toString(16, 2) + ' y: ' + this.y.toString(16, 2) + ' z: ' + this.z.toString(16, 2) + '>';\n};\n\nJPoint.prototype.isInfinity = function isInfinity() {\n  // XXX This code assumes that zero is always zero in red\n  return this.z.cmpn(0) === 0;\n};\n\nvar curve_1 = createCommonjsModule(function (module, exports) {\n  'use strict';\n\n  var curve = exports;\n  curve.base = base;\n  curve.short = short_1;\n  curve.mont =\n  /*RicMoo:ethers:require(./mont)*/\n  null;\n  curve.edwards =\n  /*RicMoo:ethers:require(./edwards)*/\n  null;\n});\nvar curves_1 = createCommonjsModule(function (module, exports) {\n  'use strict';\n\n  var curves = exports;\n  var assert = utils_1$1.assert;\n\n  function PresetCurve(options) {\n    if (options.type === 'short') this.curve = new curve_1.short(options);else if (options.type === 'edwards') this.curve = new curve_1.edwards(options);else this.curve = new curve_1.mont(options);\n    this.g = this.curve.g;\n    this.n = this.curve.n;\n    this.hash = options.hash;\n    assert(this.g.validate(), 'Invalid curve');\n    assert(this.g.mul(this.n).isInfinity(), 'Invalid curve, G*N != O');\n  }\n\n  curves.PresetCurve = PresetCurve;\n\n  function defineCurve(name, options) {\n    Object.defineProperty(curves, name, {\n      configurable: true,\n      enumerable: true,\n      get: function () {\n        var curve = new PresetCurve(options);\n        Object.defineProperty(curves, name, {\n          configurable: true,\n          enumerable: true,\n          value: curve\n        });\n        return curve;\n      }\n    });\n  }\n\n  defineCurve('p192', {\n    type: 'short',\n    prime: 'p192',\n    p: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff',\n    a: 'ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc',\n    b: '64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1',\n    n: 'ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831',\n    hash: hash.sha256,\n    gRed: false,\n    g: ['188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012', '07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811']\n  });\n  defineCurve('p224', {\n    type: 'short',\n    prime: 'p224',\n    p: 'ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001',\n    a: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe',\n    b: 'b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4',\n    n: 'ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d',\n    hash: hash.sha256,\n    gRed: false,\n    g: ['b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21', 'bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34']\n  });\n  defineCurve('p256', {\n    type: 'short',\n    prime: null,\n    p: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff',\n    a: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc',\n    b: '5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b',\n    n: 'ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551',\n    hash: hash.sha256,\n    gRed: false,\n    g: ['6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296', '4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5']\n  });\n  defineCurve('p384', {\n    type: 'short',\n    prime: null,\n    p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' + 'fffffffe ffffffff 00000000 00000000 ffffffff',\n    a: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' + 'fffffffe ffffffff 00000000 00000000 fffffffc',\n    b: 'b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f ' + '5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef',\n    n: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 ' + 'f4372ddf 581a0db2 48b0a77a ecec196a ccc52973',\n    hash: hash.sha384,\n    gRed: false,\n    g: ['aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 ' + '5502f25d bf55296c 3a545e38 72760ab7', '3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 ' + '0a60b1ce 1d7e819d 7a431d7c 90ea0e5f']\n  });\n  defineCurve('p521', {\n    type: 'short',\n    prime: null,\n    p: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' + 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' + 'ffffffff ffffffff ffffffff ffffffff ffffffff',\n    a: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' + 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' + 'ffffffff ffffffff ffffffff ffffffff fffffffc',\n    b: '00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b ' + '99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd ' + '3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00',\n    n: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' + 'ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 ' + 'f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409',\n    hash: hash.sha512,\n    gRed: false,\n    g: ['000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 ' + '053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 ' + 'a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66', '00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 ' + '579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 ' + '3fad0761 353c7086 a272c240 88be9476 9fd16650']\n  });\n  defineCurve('curve25519', {\n    type: 'mont',\n    prime: 'p25519',\n    p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',\n    a: '76d06',\n    b: '1',\n    n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',\n    hash: hash.sha256,\n    gRed: false,\n    g: ['9']\n  });\n  defineCurve('ed25519', {\n    type: 'edwards',\n    prime: 'p25519',\n    p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',\n    a: '-1',\n    c: '1',\n    // -121665 * (121666^(-1)) (mod P)\n    d: '52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3',\n    n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',\n    hash: hash.sha256,\n    gRed: false,\n    g: ['216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a', // 4/5\n    '6666666666666666666666666666666666666666666666666666666666666658']\n  });\n  var pre;\n\n  try {\n    pre =\n    /*RicMoo:ethers:require(./precomputed/secp256k1)*/\n    null.crash();\n  } catch (e) {\n    pre = undefined;\n  }\n\n  defineCurve('secp256k1', {\n    type: 'short',\n    prime: 'k256',\n    p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f',\n    a: '0',\n    b: '7',\n    n: 'ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141',\n    h: '1',\n    hash: hash.sha256,\n    // Precomputed endomorphism\n    beta: '7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee',\n    lambda: '5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72',\n    basis: [{\n      a: '3086d221a7d46bcde86c90e49284eb15',\n      b: '-e4437ed6010e88286f547fa90abfe4c3'\n    }, {\n      a: '114ca50f7a8e2f3f657c1108d9d44cfd8',\n      b: '3086d221a7d46bcde86c90e49284eb15'\n    }],\n    gRed: false,\n    g: ['79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798', '483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8', pre]\n  });\n});\n'use strict';\n\nfunction HmacDRBG(options) {\n  if (!(this instanceof HmacDRBG)) return new HmacDRBG(options);\n  this.hash = options.hash;\n  this.predResist = !!options.predResist;\n  this.outLen = this.hash.outSize;\n  this.minEntropy = options.minEntropy || this.hash.hmacStrength;\n  this._reseed = null;\n  this.reseedInterval = null;\n  this.K = null;\n  this.V = null;\n  var entropy = utils_1.toArray(options.entropy, options.entropyEnc || 'hex');\n  var nonce = utils_1.toArray(options.nonce, options.nonceEnc || 'hex');\n  var pers = utils_1.toArray(options.pers, options.persEnc || 'hex');\n  minimalisticAssert(entropy.length >= this.minEntropy / 8, 'Not enough entropy. Minimum is: ' + this.minEntropy + ' bits');\n\n  this._init(entropy, nonce, pers);\n}\n\nvar hmacDrbg = HmacDRBG;\n\nHmacDRBG.prototype._init = function init(entropy, nonce, pers) {\n  var seed = entropy.concat(nonce).concat(pers);\n  this.K = new Array(this.outLen / 8);\n  this.V = new Array(this.outLen / 8);\n\n  for (var i = 0; i < this.V.length; i++) {\n    this.K[i] = 0x00;\n    this.V[i] = 0x01;\n  }\n\n  this._update(seed);\n\n  this._reseed = 1;\n  this.reseedInterval = 0x1000000000000; // 2^48\n};\n\nHmacDRBG.prototype._hmac = function hmac() {\n  return new hash.hmac(this.hash, this.K);\n};\n\nHmacDRBG.prototype._update = function update(seed) {\n  var kmac = this._hmac().update(this.V).update([0x00]);\n\n  if (seed) kmac = kmac.update(seed);\n  this.K = kmac.digest();\n  this.V = this._hmac().update(this.V).digest();\n  if (!seed) return;\n  this.K = this._hmac().update(this.V).update([0x01]).update(seed).digest();\n  this.V = this._hmac().update(this.V).digest();\n};\n\nHmacDRBG.prototype.reseed = function reseed(entropy, entropyEnc, add, addEnc) {\n  // Optional entropy enc\n  if (typeof entropyEnc !== 'string') {\n    addEnc = add;\n    add = entropyEnc;\n    entropyEnc = null;\n  }\n\n  entropy = utils_1.toArray(entropy, entropyEnc);\n  add = utils_1.toArray(add, addEnc);\n  minimalisticAssert(entropy.length >= this.minEntropy / 8, 'Not enough entropy. Minimum is: ' + this.minEntropy + ' bits');\n\n  this._update(entropy.concat(add || []));\n\n  this._reseed = 1;\n};\n\nHmacDRBG.prototype.generate = function generate(len, enc, add, addEnc) {\n  if (this._reseed > this.reseedInterval) throw new Error('Reseed is required'); // Optional encoding\n\n  if (typeof enc !== 'string') {\n    addEnc = add;\n    add = enc;\n    enc = null;\n  } // Optional additional data\n\n\n  if (add) {\n    add = utils_1.toArray(add, addEnc || 'hex');\n\n    this._update(add);\n  }\n\n  var temp = [];\n\n  while (temp.length < len) {\n    this.V = this._hmac().update(this.V).digest();\n    temp = temp.concat(this.V);\n  }\n\n  var res = temp.slice(0, len);\n\n  this._update(add);\n\n  this._reseed++;\n  return utils_1.encode(res, enc);\n};\n\n'use strict';\n\nvar assert$3 = utils_1$1.assert;\n\nfunction KeyPair(ec, options) {\n  this.ec = ec;\n  this.priv = null;\n  this.pub = null; // KeyPair(ec, { priv: ..., pub: ... })\n\n  if (options.priv) this._importPrivate(options.priv, options.privEnc);\n  if (options.pub) this._importPublic(options.pub, options.pubEnc);\n}\n\nvar key = KeyPair;\n\nKeyPair.fromPublic = function fromPublic(ec, pub, enc) {\n  if (pub instanceof KeyPair) return pub;\n  return new KeyPair(ec, {\n    pub: pub,\n    pubEnc: enc\n  });\n};\n\nKeyPair.fromPrivate = function fromPrivate(ec, priv, enc) {\n  if (priv instanceof KeyPair) return priv;\n  return new KeyPair(ec, {\n    priv: priv,\n    privEnc: enc\n  });\n};\n\nKeyPair.prototype.validate = function validate() {\n  var pub = this.getPublic();\n  if (pub.isInfinity()) return {\n    result: false,\n    reason: 'Invalid public key'\n  };\n  if (!pub.validate()) return {\n    result: false,\n    reason: 'Public key is not a point'\n  };\n  if (!pub.mul(this.ec.curve.n).isInfinity()) return {\n    result: false,\n    reason: 'Public key * N != O'\n  };\n  return {\n    result: true,\n    reason: null\n  };\n};\n\nKeyPair.prototype.getPublic = function getPublic(compact, enc) {\n  // compact is optional argument\n  if (typeof compact === 'string') {\n    enc = compact;\n    compact = null;\n  }\n\n  if (!this.pub) this.pub = this.ec.g.mul(this.priv);\n  if (!enc) return this.pub;\n  return this.pub.encode(enc, compact);\n};\n\nKeyPair.prototype.getPrivate = function getPrivate(enc) {\n  if (enc === 'hex') return this.priv.toString(16, 2);else return this.priv;\n};\n\nKeyPair.prototype._importPrivate = function _importPrivate(key, enc) {\n  this.priv = new BN(key, enc || 16); // Ensure that the priv won't be bigger than n, otherwise we may fail\n  // in fixed multiplication method\n\n  this.priv = this.priv.umod(this.ec.curve.n);\n};\n\nKeyPair.prototype._importPublic = function _importPublic(key, enc) {\n  if (key.x || key.y) {\n    // Montgomery points only have an `x` coordinate.\n    // Weierstrass/Edwards points on the other hand have both `x` and\n    // `y` coordinates.\n    if (this.ec.curve.type === 'mont') {\n      assert$3(key.x, 'Need x coordinate');\n    } else if (this.ec.curve.type === 'short' || this.ec.curve.type === 'edwards') {\n      assert$3(key.x && key.y, 'Need both x and y coordinate');\n    }\n\n    this.pub = this.ec.curve.point(key.x, key.y);\n    return;\n  }\n\n  this.pub = this.ec.curve.decodePoint(key, enc);\n}; // ECDH\n\n\nKeyPair.prototype.derive = function derive(pub) {\n  return pub.mul(this.priv).getX();\n}; // ECDSA\n\n\nKeyPair.prototype.sign = function sign(msg, enc, options) {\n  return this.ec.sign(msg, this, enc, options);\n};\n\nKeyPair.prototype.verify = function verify(msg, signature) {\n  return this.ec.verify(msg, signature, this);\n};\n\nKeyPair.prototype.inspect = function inspect() {\n  return '<Key priv: ' + (this.priv && this.priv.toString(16, 2)) + ' pub: ' + (this.pub && this.pub.inspect()) + ' >';\n};\n\n'use strict';\n\nvar assert$4 = utils_1$1.assert;\n\nfunction Signature(options, enc) {\n  if (options instanceof Signature) return options;\n  if (this._importDER(options, enc)) return;\n  assert$4(options.r && options.s, 'Signature without r or s');\n  this.r = new BN(options.r, 16);\n  this.s = new BN(options.s, 16);\n  if (options.recoveryParam === undefined) this.recoveryParam = null;else this.recoveryParam = options.recoveryParam;\n}\n\nvar signature = Signature;\n\nfunction Position() {\n  this.place = 0;\n}\n\nfunction getLength(buf, p) {\n  var initial = buf[p.place++];\n\n  if (!(initial & 0x80)) {\n    return initial;\n  }\n\n  var octetLen = initial & 0xf; // Indefinite length or overflow\n\n  if (octetLen === 0 || octetLen > 4) {\n    return false;\n  }\n\n  var val = 0;\n\n  for (var i = 0, off = p.place; i < octetLen; i++, off++) {\n    val <<= 8;\n    val |= buf[off];\n    val >>>= 0;\n  } // Leading zeroes\n\n\n  if (val <= 0x7f) {\n    return false;\n  }\n\n  p.place = off;\n  return val;\n}\n\nfunction rmPadding(buf) {\n  var i = 0;\n  var len = buf.length - 1;\n\n  while (!buf[i] && !(buf[i + 1] & 0x80) && i < len) {\n    i++;\n  }\n\n  if (i === 0) {\n    return buf;\n  }\n\n  return buf.slice(i);\n}\n\nSignature.prototype._importDER = function _importDER(data, enc) {\n  data = utils_1$1.toArray(data, enc);\n  var p = new Position();\n\n  if (data[p.place++] !== 0x30) {\n    return false;\n  }\n\n  var len = getLength(data, p);\n\n  if (len === false) {\n    return false;\n  }\n\n  if (len + p.place !== data.length) {\n    return false;\n  }\n\n  if (data[p.place++] !== 0x02) {\n    return false;\n  }\n\n  var rlen = getLength(data, p);\n\n  if (rlen === false) {\n    return false;\n  }\n\n  var r = data.slice(p.place, rlen + p.place);\n  p.place += rlen;\n\n  if (data[p.place++] !== 0x02) {\n    return false;\n  }\n\n  var slen = getLength(data, p);\n\n  if (slen === false) {\n    return false;\n  }\n\n  if (data.length !== slen + p.place) {\n    return false;\n  }\n\n  var s = data.slice(p.place, slen + p.place);\n\n  if (r[0] === 0) {\n    if (r[1] & 0x80) {\n      r = r.slice(1);\n    } else {\n      // Leading zeroes\n      return false;\n    }\n  }\n\n  if (s[0] === 0) {\n    if (s[1] & 0x80) {\n      s = s.slice(1);\n    } else {\n      // Leading zeroes\n      return false;\n    }\n  }\n\n  this.r = new BN(r);\n  this.s = new BN(s);\n  this.recoveryParam = null;\n  return true;\n};\n\nfunction constructLength(arr, len) {\n  if (len < 0x80) {\n    arr.push(len);\n    return;\n  }\n\n  var octets = 1 + (Math.log(len) / Math.LN2 >>> 3);\n  arr.push(octets | 0x80);\n\n  while (--octets) {\n    arr.push(len >>> (octets << 3) & 0xff);\n  }\n\n  arr.push(len);\n}\n\nSignature.prototype.toDER = function toDER(enc) {\n  var r = this.r.toArray();\n  var s = this.s.toArray(); // Pad values\n\n  if (r[0] & 0x80) r = [0].concat(r); // Pad values\n\n  if (s[0] & 0x80) s = [0].concat(s);\n  r = rmPadding(r);\n  s = rmPadding(s);\n\n  while (!s[0] && !(s[1] & 0x80)) {\n    s = s.slice(1);\n  }\n\n  var arr = [0x02];\n  constructLength(arr, r.length);\n  arr = arr.concat(r);\n  arr.push(0x02);\n  constructLength(arr, s.length);\n  var backHalf = arr.concat(s);\n  var res = [0x30];\n  constructLength(res, backHalf.length);\n  res = res.concat(backHalf);\n  return utils_1$1.encode(res, enc);\n};\n\n'use strict';\n\nvar rand =\n/*RicMoo:ethers:require(brorand)*/\nfunction () {\n  throw new Error('unsupported');\n};\n\nvar assert$5 = utils_1$1.assert;\n\nfunction EC(options) {\n  if (!(this instanceof EC)) return new EC(options); // Shortcut `elliptic.ec(curve-name)`\n\n  if (typeof options === 'string') {\n    assert$5(curves_1.hasOwnProperty(options), 'Unknown curve ' + options);\n    options = curves_1[options];\n  } // Shortcut for `elliptic.ec(elliptic.curves.curveName)`\n\n\n  if (options instanceof curves_1.PresetCurve) options = {\n    curve: options\n  };\n  this.curve = options.curve.curve;\n  this.n = this.curve.n;\n  this.nh = this.n.ushrn(1);\n  this.g = this.curve.g; // Point on curve\n\n  this.g = options.curve.g;\n  this.g.precompute(options.curve.n.bitLength() + 1); // Hash for function for DRBG\n\n  this.hash = options.hash || options.curve.hash;\n}\n\nvar ec = EC;\n\nEC.prototype.keyPair = function keyPair(options) {\n  return new key(this, options);\n};\n\nEC.prototype.keyFromPrivate = function keyFromPrivate(priv, enc) {\n  return key.fromPrivate(this, priv, enc);\n};\n\nEC.prototype.keyFromPublic = function keyFromPublic(pub, enc) {\n  return key.fromPublic(this, pub, enc);\n};\n\nEC.prototype.genKeyPair = function genKeyPair(options) {\n  if (!options) options = {}; // Instantiate Hmac_DRBG\n\n  var drbg = new hmacDrbg({\n    hash: this.hash,\n    pers: options.pers,\n    persEnc: options.persEnc || 'utf8',\n    entropy: options.entropy || rand(this.hash.hmacStrength),\n    entropyEnc: options.entropy && options.entropyEnc || 'utf8',\n    nonce: this.n.toArray()\n  });\n  var bytes = this.n.byteLength();\n  var ns2 = this.n.sub(new BN(2));\n\n  do {\n    var priv = new BN(drbg.generate(bytes));\n    if (priv.cmp(ns2) > 0) continue;\n    priv.iaddn(1);\n    return this.keyFromPrivate(priv);\n  } while (true);\n};\n\nEC.prototype._truncateToN = function truncateToN(msg, truncOnly) {\n  var delta = msg.byteLength() * 8 - this.n.bitLength();\n  if (delta > 0) msg = msg.ushrn(delta);\n  if (!truncOnly && msg.cmp(this.n) >= 0) return msg.sub(this.n);else return msg;\n};\n\nEC.prototype.sign = function sign(msg, key, enc, options) {\n  if (typeof enc === 'object') {\n    options = enc;\n    enc = null;\n  }\n\n  if (!options) options = {};\n  key = this.keyFromPrivate(key, enc);\n  msg = this._truncateToN(new BN(msg, 16)); // Zero-extend key to provide enough entropy\n\n  var bytes = this.n.byteLength();\n  var bkey = key.getPrivate().toArray('be', bytes); // Zero-extend nonce to have the same byte size as N\n\n  var nonce = msg.toArray('be', bytes); // Instantiate Hmac_DRBG\n\n  var drbg = new hmacDrbg({\n    hash: this.hash,\n    entropy: bkey,\n    nonce: nonce,\n    pers: options.pers,\n    persEnc: options.persEnc || 'utf8'\n  }); // Number of bytes to generate\n\n  var ns1 = this.n.sub(new BN(1));\n\n  for (var iter = 0; true; iter++) {\n    var k = options.k ? options.k(iter) : new BN(drbg.generate(this.n.byteLength()));\n    k = this._truncateToN(k, true);\n    if (k.cmpn(1) <= 0 || k.cmp(ns1) >= 0) continue;\n    var kp = this.g.mul(k);\n    if (kp.isInfinity()) continue;\n    var kpX = kp.getX();\n    var r = kpX.umod(this.n);\n    if (r.cmpn(0) === 0) continue;\n    var s = k.invm(this.n).mul(r.mul(key.getPrivate()).iadd(msg));\n    s = s.umod(this.n);\n    if (s.cmpn(0) === 0) continue;\n    var recoveryParam = (kp.getY().isOdd() ? 1 : 0) | (kpX.cmp(r) !== 0 ? 2 : 0); // Use complement of `s`, if it is > `n / 2`\n\n    if (options.canonical && s.cmp(this.nh) > 0) {\n      s = this.n.sub(s);\n      recoveryParam ^= 1;\n    }\n\n    return new signature({\n      r: r,\n      s: s,\n      recoveryParam: recoveryParam\n    });\n  }\n};\n\nEC.prototype.verify = function verify(msg, signature$1, key, enc) {\n  msg = this._truncateToN(new BN(msg, 16));\n  key = this.keyFromPublic(key, enc);\n  signature$1 = new signature(signature$1, 'hex'); // Perform primitive values validation\n\n  var r = signature$1.r;\n  var s = signature$1.s;\n  if (r.cmpn(1) < 0 || r.cmp(this.n) >= 0) return false;\n  if (s.cmpn(1) < 0 || s.cmp(this.n) >= 0) return false; // Validate signature\n\n  var sinv = s.invm(this.n);\n  var u1 = sinv.mul(msg).umod(this.n);\n  var u2 = sinv.mul(r).umod(this.n);\n\n  if (!this.curve._maxwellTrick) {\n    var p = this.g.mulAdd(u1, key.getPublic(), u2);\n    if (p.isInfinity()) return false;\n    return p.getX().umod(this.n).cmp(r) === 0;\n  } // NOTE: Greg Maxwell's trick, inspired by:\n  // https://git.io/vad3K\n\n\n  var p = this.g.jmulAdd(u1, key.getPublic(), u2);\n  if (p.isInfinity()) return false; // Compare `p.x` of Jacobian point with `r`,\n  // this will do `p.x == r * p.z^2` instead of multiplying `p.x` by the\n  // inverse of `p.z^2`\n\n  return p.eqXToP(r);\n};\n\nEC.prototype.recoverPubKey = function (msg, signature$1, j, enc) {\n  assert$5((3 & j) === j, 'The recovery param is more than two bits');\n  signature$1 = new signature(signature$1, enc);\n  var n = this.n;\n  var e = new BN(msg);\n  var r = signature$1.r;\n  var s = signature$1.s; // A set LSB signifies that the y-coordinate is odd\n\n  var isYOdd = j & 1;\n  var isSecondKey = j >> 1;\n  if (r.cmp(this.curve.p.umod(this.curve.n)) >= 0 && isSecondKey) throw new Error('Unable to find sencond key candinate'); // 1.1. Let x = r + jn.\n\n  if (isSecondKey) r = this.curve.pointFromX(r.add(this.curve.n), isYOdd);else r = this.curve.pointFromX(r, isYOdd);\n  var rInv = signature$1.r.invm(n);\n  var s1 = n.sub(e).mul(rInv).umod(n);\n  var s2 = s.mul(rInv).umod(n); // 1.6.1 Compute Q = r^-1 (sR -  eG)\n  //               Q = r^-1 (sR + -eG)\n\n  return this.g.mulAdd(s1, r, s2);\n};\n\nEC.prototype.getKeyRecoveryParam = function (e, signature$1, Q, enc) {\n  signature$1 = new signature(signature$1, enc);\n  if (signature$1.recoveryParam !== null) return signature$1.recoveryParam;\n\n  for (var i = 0; i < 4; i++) {\n    var Qprime;\n\n    try {\n      Qprime = this.recoverPubKey(e, signature$1, i);\n    } catch (e) {\n      continue;\n    }\n\n    if (Qprime.eq(Q)) return i;\n  }\n\n  throw new Error('Unable to find valid recovery factor');\n};\n\nvar elliptic_1 = createCommonjsModule(function (module, exports) {\n  'use strict';\n\n  var elliptic = exports;\n  elliptic.version =\n  /*RicMoo:ethers*/\n  {\n    version: \"6.5.3\"\n  }.version;\n  elliptic.utils = utils_1$1;\n\n  elliptic.rand =\n  /*RicMoo:ethers:require(brorand)*/\n  function () {\n    throw new Error('unsupported');\n  };\n\n  elliptic.curve = curve_1;\n  elliptic.curves = curves_1; // Protocols\n\n  elliptic.ec = ec;\n  elliptic.eddsa =\n  /*RicMoo:ethers:require(./elliptic/eddsa)*/\n  null;\n});\nvar EC$1 = elliptic_1.ec;\nexport { EC$1 as EC };","map":{"version":3,"sources":["/Users/mdastugu/Projects/safe-react-apps/node_modules/@ethersproject/signing-key/lib.esm/elliptic.js"],"names":["BN","hash","commonjsGlobal","globalThis","window","global","self","getDefaultExportFromCjs","x","__esModule","Object","prototype","hasOwnProperty","call","createCommonjsModule","fn","basedir","module","path","exports","require","base","commonjsRequire","undefined","getDefaultExportFromNamespaceIfPresent","n","getDefaultExportFromNamespaceIfNotNamed","keys","length","getAugmentedNamespace","a","defineProperty","value","forEach","k","d","getOwnPropertyDescriptor","get","enumerable","Error","minimalisticAssert","assert","val","msg","equal","assertEqual","l","r","utils_1","utils","toArray","enc","Array","isArray","slice","res","i","replace","push","parseInt","c","charCodeAt","hi","lo","zero2","word","toHex","toString","encode","arr","utils_1$1","getNAF","num","w","bits","naf","Math","max","bitLength","fill","ws","clone","z","mod","andln","isOdd","isubn","iushrn","getJSF","k1","k2","jsf","d1","d2","cmpn","m14","m24","u1","m8","u2","cachedProperty","obj","name","computer","key","parseBytes","bytes","intFromLE","assert$1","BaseCurve","type","conf","p","red","prime","mont","zero","toRed","one","two","g","pointFromJSON","gRed","_wnafT1","_wnafT2","_wnafT3","_wnafT4","_bitLength","adjustCount","div","redN","_maxwellTrick","point","validate","_fixedNafMul","precomputed","doubles","_getDoubles","I","step","repr","j","nafW","jpoint","b","mixedAdd","points","neg","add","toP","_wnafMul","nafPoints","_getNAFPoints","wnd","acc","dblp","_wnafMulAdd","defW","coeffs","len","jacobianResult","wndWidth","comb","y","cmp","toJ","redNeg","index","ja","jb","tmp","BasePoint","curve","eq","decodePoint","byteLength","pointFromX","encodeCompressed","_encode","compact","getX","getY","isEven","concat","precompute","power","beta","_getBeta","_hasDoubles","ceil","dbl","inherits_browser","create","inherits","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","assert$2","ShortCurve","tinv","redInvm","zeroA","fromRed","threeA","sub","endo","_getEndomorphism","_endoWnafT1","_endoWnafT2","short_1","modn","lambda","betas","_getEndoRoots","lambdas","mul","redMul","basis","map","vec","_getEndoBasis","ntinv","s","redSqrt","l1","redAdd","l2","redSub","aprxSqrt","ushrn","floor","u","v","x1","y1","x2","y2","a0","b0","a1","b1","a2","b2","prevR","q","len1","sqr","len2","negative","_endoSplit","v1","v2","c1","divRound","c2","p1","p2","q1","q2","odd","redSqr","redIAdd","inf","ax","rhs","redISub","_endoWnafMulAdd","npoints","ncoeffs","split","ineg","Point","isRed","forceRed","fromJSON","pre","endoMul","toJSON","JSON","parse","obj2point","inspect","isInfinity","nx","ny","ys1","dyinv","mulAdd","jmulAdd","_precompute","negate","JPoint","zOne","zinv","zinv2","ay","pz2","z2","s1","s2","h","h2","h3","nz","pow","jx","jy","jz","jz4","jyd","jx2","jyd2","jyd4","t1","t2","dny","_zeroDbl","_threeDbl","_dbl","xx","yy","yyyy","m","t","yyyy8","e","f","c8","delta","gamma","alpha","beta4","beta8","ggamma8","jy2","jxd4","jyd8","trpl","zz","mm","ee","yyu4","kbase","z3","pz3","eqXToP","zs","rx","xc","iadd","curve_1","short","edwards","curves_1","curves","PresetCurve","options","defineCurve","sha256","sha384","sha512","crash","HmacDRBG","predResist","outLen","outSize","minEntropy","hmacStrength","_reseed","reseedInterval","K","V","entropy","entropyEnc","nonce","nonceEnc","pers","persEnc","_init","hmacDrbg","init","seed","_update","_hmac","hmac","update","kmac","digest","reseed","addEnc","generate","temp","assert$3","KeyPair","ec","priv","pub","_importPrivate","privEnc","_importPublic","pubEnc","fromPublic","fromPrivate","getPublic","result","reason","getPrivate","umod","derive","sign","verify","signature","assert$4","Signature","_importDER","recoveryParam","Position","place","getLength","buf","initial","octetLen","off","rmPadding","data","rlen","slen","constructLength","octets","log","LN2","toDER","backHalf","rand","assert$5","EC","nh","keyPair","keyFromPrivate","keyFromPublic","genKeyPair","drbg","ns2","iaddn","_truncateToN","truncateToN","truncOnly","bkey","ns1","iter","kp","kpX","invm","canonical","signature$1","sinv","recoverPubKey","isYOdd","isSecondKey","rInv","getKeyRecoveryParam","Q","Qprime","elliptic_1","elliptic","version","eddsa","EC$1"],"mappings":"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","sourcesContent":["import BN from 'bn.js';\nimport hash from 'hash.js';\n\nvar commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\nfunction getDefaultExportFromCjs (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nfunction createCommonjsModule(fn, basedir, module) {\n\treturn module = {\n\t\tpath: basedir,\n\t\texports: {},\n\t\trequire: function (path, base) {\n\t\t\treturn commonjsRequire(path, (base === undefined || base === null) ? module.path : base);\n\t\t}\n\t}, fn(module, module.exports), module.exports;\n}\n\nfunction getDefaultExportFromNamespaceIfPresent (n) {\n\treturn n && Object.prototype.hasOwnProperty.call(n, 'default') ? n['default'] : n;\n}\n\nfunction getDefaultExportFromNamespaceIfNotNamed (n) {\n\treturn n && Object.prototype.hasOwnProperty.call(n, 'default') && Object.keys(n).length === 1 ? n['default'] : n;\n}\n\nfunction getAugmentedNamespace(n) {\n\tif (n.__esModule) return n;\n\tvar a = Object.defineProperty({}, '__esModule', {value: true});\n\tObject.keys(n).forEach(function (k) {\n\t\tvar d = Object.getOwnPropertyDescriptor(n, k);\n\t\tObject.defineProperty(a, k, d.get ? d : {\n\t\t\tenumerable: true,\n\t\t\tget: function () {\n\t\t\t\treturn n[k];\n\t\t\t}\n\t\t});\n\t});\n\treturn a;\n}\n\nfunction commonjsRequire () {\n\tthrow new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs');\n}\n\nvar minimalisticAssert = assert;\n\nfunction assert(val, msg) {\n  if (!val)\n    throw new Error(msg || 'Assertion failed');\n}\n\nassert.equal = function assertEqual(l, r, msg) {\n  if (l != r)\n    throw new Error(msg || ('Assertion failed: ' + l + ' != ' + r));\n};\n\nvar utils_1 = createCommonjsModule(function (module, exports) {\n'use strict';\n\nvar utils = exports;\n\nfunction toArray(msg, enc) {\n  if (Array.isArray(msg))\n    return msg.slice();\n  if (!msg)\n    return [];\n  var res = [];\n  if (typeof msg !== 'string') {\n    for (var i = 0; i < msg.length; i++)\n      res[i] = msg[i] | 0;\n    return res;\n  }\n  if (enc === 'hex') {\n    msg = msg.replace(/[^a-z0-9]+/ig, '');\n    if (msg.length % 2 !== 0)\n      msg = '0' + msg;\n    for (var i = 0; i < msg.length; i += 2)\n      res.push(parseInt(msg[i] + msg[i + 1], 16));\n  } else {\n    for (var i = 0; i < msg.length; i++) {\n      var c = msg.charCodeAt(i);\n      var hi = c >> 8;\n      var lo = c & 0xff;\n      if (hi)\n        res.push(hi, lo);\n      else\n        res.push(lo);\n    }\n  }\n  return res;\n}\nutils.toArray = toArray;\n\nfunction zero2(word) {\n  if (word.length === 1)\n    return '0' + word;\n  else\n    return word;\n}\nutils.zero2 = zero2;\n\nfunction toHex(msg) {\n  var res = '';\n  for (var i = 0; i < msg.length; i++)\n    res += zero2(msg[i].toString(16));\n  return res;\n}\nutils.toHex = toHex;\n\nutils.encode = function encode(arr, enc) {\n  if (enc === 'hex')\n    return toHex(arr);\n  else\n    return arr;\n};\n});\n\nvar utils_1$1 = createCommonjsModule(function (module, exports) {\n'use strict';\n\nvar utils = exports;\n\n\n\n\nutils.assert = minimalisticAssert;\nutils.toArray = utils_1.toArray;\nutils.zero2 = utils_1.zero2;\nutils.toHex = utils_1.toHex;\nutils.encode = utils_1.encode;\n\n// Represent num in a w-NAF form\nfunction getNAF(num, w, bits) {\n  var naf = new Array(Math.max(num.bitLength(), bits) + 1);\n  naf.fill(0);\n\n  var ws = 1 << (w + 1);\n  var k = num.clone();\n\n  for (var i = 0; i < naf.length; i++) {\n    var z;\n    var mod = k.andln(ws - 1);\n    if (k.isOdd()) {\n      if (mod > (ws >> 1) - 1)\n        z = (ws >> 1) - mod;\n      else\n        z = mod;\n      k.isubn(z);\n    } else {\n      z = 0;\n    }\n\n    naf[i] = z;\n    k.iushrn(1);\n  }\n\n  return naf;\n}\nutils.getNAF = getNAF;\n\n// Represent k1, k2 in a Joint Sparse Form\nfunction getJSF(k1, k2) {\n  var jsf = [\n    [],\n    []\n  ];\n\n  k1 = k1.clone();\n  k2 = k2.clone();\n  var d1 = 0;\n  var d2 = 0;\n  while (k1.cmpn(-d1) > 0 || k2.cmpn(-d2) > 0) {\n\n    // First phase\n    var m14 = (k1.andln(3) + d1) & 3;\n    var m24 = (k2.andln(3) + d2) & 3;\n    if (m14 === 3)\n      m14 = -1;\n    if (m24 === 3)\n      m24 = -1;\n    var u1;\n    if ((m14 & 1) === 0) {\n      u1 = 0;\n    } else {\n      var m8 = (k1.andln(7) + d1) & 7;\n      if ((m8 === 3 || m8 === 5) && m24 === 2)\n        u1 = -m14;\n      else\n        u1 = m14;\n    }\n    jsf[0].push(u1);\n\n    var u2;\n    if ((m24 & 1) === 0) {\n      u2 = 0;\n    } else {\n      var m8 = (k2.andln(7) + d2) & 7;\n      if ((m8 === 3 || m8 === 5) && m14 === 2)\n        u2 = -m24;\n      else\n        u2 = m24;\n    }\n    jsf[1].push(u2);\n\n    // Second phase\n    if (2 * d1 === u1 + 1)\n      d1 = 1 - d1;\n    if (2 * d2 === u2 + 1)\n      d2 = 1 - d2;\n    k1.iushrn(1);\n    k2.iushrn(1);\n  }\n\n  return jsf;\n}\nutils.getJSF = getJSF;\n\nfunction cachedProperty(obj, name, computer) {\n  var key = '_' + name;\n  obj.prototype[name] = function cachedProperty() {\n    return this[key] !== undefined ? this[key] :\n           this[key] = computer.call(this);\n  };\n}\nutils.cachedProperty = cachedProperty;\n\nfunction parseBytes(bytes) {\n  return typeof bytes === 'string' ? utils.toArray(bytes, 'hex') :\n                                     bytes;\n}\nutils.parseBytes = parseBytes;\n\nfunction intFromLE(bytes) {\n  return new BN(bytes, 'hex', 'le');\n}\nutils.intFromLE = intFromLE;\n});\n\n'use strict';\n\n\n\nvar getNAF = utils_1$1.getNAF;\nvar getJSF = utils_1$1.getJSF;\nvar assert$1 = utils_1$1.assert;\n\nfunction BaseCurve(type, conf) {\n  this.type = type;\n  this.p = new BN(conf.p, 16);\n\n  // Use Montgomery, when there is no fast reduction for the prime\n  this.red = conf.prime ? BN.red(conf.prime) : BN.mont(this.p);\n\n  // Useful for many curves\n  this.zero = new BN(0).toRed(this.red);\n  this.one = new BN(1).toRed(this.red);\n  this.two = new BN(2).toRed(this.red);\n\n  // Curve configuration, optional\n  this.n = conf.n && new BN(conf.n, 16);\n  this.g = conf.g && this.pointFromJSON(conf.g, conf.gRed);\n\n  // Temporary arrays\n  this._wnafT1 = new Array(4);\n  this._wnafT2 = new Array(4);\n  this._wnafT3 = new Array(4);\n  this._wnafT4 = new Array(4);\n\n  this._bitLength = this.n ? this.n.bitLength() : 0;\n\n  // Generalized Greg Maxwell's trick\n  var adjustCount = this.n && this.p.div(this.n);\n  if (!adjustCount || adjustCount.cmpn(100) > 0) {\n    this.redN = null;\n  } else {\n    this._maxwellTrick = true;\n    this.redN = this.n.toRed(this.red);\n  }\n}\nvar base = BaseCurve;\n\nBaseCurve.prototype.point = function point() {\n  throw new Error('Not implemented');\n};\n\nBaseCurve.prototype.validate = function validate() {\n  throw new Error('Not implemented');\n};\n\nBaseCurve.prototype._fixedNafMul = function _fixedNafMul(p, k) {\n  assert$1(p.precomputed);\n  var doubles = p._getDoubles();\n\n  var naf = getNAF(k, 1, this._bitLength);\n  var I = (1 << (doubles.step + 1)) - (doubles.step % 2 === 0 ? 2 : 1);\n  I /= 3;\n\n  // Translate into more windowed form\n  var repr = [];\n  for (var j = 0; j < naf.length; j += doubles.step) {\n    var nafW = 0;\n    for (var k = j + doubles.step - 1; k >= j; k--)\n      nafW = (nafW << 1) + naf[k];\n    repr.push(nafW);\n  }\n\n  var a = this.jpoint(null, null, null);\n  var b = this.jpoint(null, null, null);\n  for (var i = I; i > 0; i--) {\n    for (var j = 0; j < repr.length; j++) {\n      var nafW = repr[j];\n      if (nafW === i)\n        b = b.mixedAdd(doubles.points[j]);\n      else if (nafW === -i)\n        b = b.mixedAdd(doubles.points[j].neg());\n    }\n    a = a.add(b);\n  }\n  return a.toP();\n};\n\nBaseCurve.prototype._wnafMul = function _wnafMul(p, k) {\n  var w = 4;\n\n  // Precompute window\n  var nafPoints = p._getNAFPoints(w);\n  w = nafPoints.wnd;\n  var wnd = nafPoints.points;\n\n  // Get NAF form\n  var naf = getNAF(k, w, this._bitLength);\n\n  // Add `this`*(N+1) for every w-NAF index\n  var acc = this.jpoint(null, null, null);\n  for (var i = naf.length - 1; i >= 0; i--) {\n    // Count zeroes\n    for (var k = 0; i >= 0 && naf[i] === 0; i--)\n      k++;\n    if (i >= 0)\n      k++;\n    acc = acc.dblp(k);\n\n    if (i < 0)\n      break;\n    var z = naf[i];\n    assert$1(z !== 0);\n    if (p.type === 'affine') {\n      // J +- P\n      if (z > 0)\n        acc = acc.mixedAdd(wnd[(z - 1) >> 1]);\n      else\n        acc = acc.mixedAdd(wnd[(-z - 1) >> 1].neg());\n    } else {\n      // J +- J\n      if (z > 0)\n        acc = acc.add(wnd[(z - 1) >> 1]);\n      else\n        acc = acc.add(wnd[(-z - 1) >> 1].neg());\n    }\n  }\n  return p.type === 'affine' ? acc.toP() : acc;\n};\n\nBaseCurve.prototype._wnafMulAdd = function _wnafMulAdd(defW,\n                                                       points,\n                                                       coeffs,\n                                                       len,\n                                                       jacobianResult) {\n  var wndWidth = this._wnafT1;\n  var wnd = this._wnafT2;\n  var naf = this._wnafT3;\n\n  // Fill all arrays\n  var max = 0;\n  for (var i = 0; i < len; i++) {\n    var p = points[i];\n    var nafPoints = p._getNAFPoints(defW);\n    wndWidth[i] = nafPoints.wnd;\n    wnd[i] = nafPoints.points;\n  }\n\n  // Comb small window NAFs\n  for (var i = len - 1; i >= 1; i -= 2) {\n    var a = i - 1;\n    var b = i;\n    if (wndWidth[a] !== 1 || wndWidth[b] !== 1) {\n      naf[a] = getNAF(coeffs[a], wndWidth[a], this._bitLength);\n      naf[b] = getNAF(coeffs[b], wndWidth[b], this._bitLength);\n      max = Math.max(naf[a].length, max);\n      max = Math.max(naf[b].length, max);\n      continue;\n    }\n\n    var comb = [\n      points[a], /* 1 */\n      null, /* 3 */\n      null, /* 5 */\n      points[b] /* 7 */\n    ];\n\n    // Try to avoid Projective points, if possible\n    if (points[a].y.cmp(points[b].y) === 0) {\n      comb[1] = points[a].add(points[b]);\n      comb[2] = points[a].toJ().mixedAdd(points[b].neg());\n    } else if (points[a].y.cmp(points[b].y.redNeg()) === 0) {\n      comb[1] = points[a].toJ().mixedAdd(points[b]);\n      comb[2] = points[a].add(points[b].neg());\n    } else {\n      comb[1] = points[a].toJ().mixedAdd(points[b]);\n      comb[2] = points[a].toJ().mixedAdd(points[b].neg());\n    }\n\n    var index = [\n      -3, /* -1 -1 */\n      -1, /* -1 0 */\n      -5, /* -1 1 */\n      -7, /* 0 -1 */\n      0, /* 0 0 */\n      7, /* 0 1 */\n      5, /* 1 -1 */\n      1, /* 1 0 */\n      3  /* 1 1 */\n    ];\n\n    var jsf = getJSF(coeffs[a], coeffs[b]);\n    max = Math.max(jsf[0].length, max);\n    naf[a] = new Array(max);\n    naf[b] = new Array(max);\n    for (var j = 0; j < max; j++) {\n      var ja = jsf[0][j] | 0;\n      var jb = jsf[1][j] | 0;\n\n      naf[a][j] = index[(ja + 1) * 3 + (jb + 1)];\n      naf[b][j] = 0;\n      wnd[a] = comb;\n    }\n  }\n\n  var acc = this.jpoint(null, null, null);\n  var tmp = this._wnafT4;\n  for (var i = max; i >= 0; i--) {\n    var k = 0;\n\n    while (i >= 0) {\n      var zero = true;\n      for (var j = 0; j < len; j++) {\n        tmp[j] = naf[j][i] | 0;\n        if (tmp[j] !== 0)\n          zero = false;\n      }\n      if (!zero)\n        break;\n      k++;\n      i--;\n    }\n    if (i >= 0)\n      k++;\n    acc = acc.dblp(k);\n    if (i < 0)\n      break;\n\n    for (var j = 0; j < len; j++) {\n      var z = tmp[j];\n      var p;\n      if (z === 0)\n        continue;\n      else if (z > 0)\n        p = wnd[j][(z - 1) >> 1];\n      else if (z < 0)\n        p = wnd[j][(-z - 1) >> 1].neg();\n\n      if (p.type === 'affine')\n        acc = acc.mixedAdd(p);\n      else\n        acc = acc.add(p);\n    }\n  }\n  // Zeroify references\n  for (var i = 0; i < len; i++)\n    wnd[i] = null;\n\n  if (jacobianResult)\n    return acc;\n  else\n    return acc.toP();\n};\n\nfunction BasePoint(curve, type) {\n  this.curve = curve;\n  this.type = type;\n  this.precomputed = null;\n}\nBaseCurve.BasePoint = BasePoint;\n\nBasePoint.prototype.eq = function eq(/*other*/) {\n  throw new Error('Not implemented');\n};\n\nBasePoint.prototype.validate = function validate() {\n  return this.curve.validate(this);\n};\n\nBaseCurve.prototype.decodePoint = function decodePoint(bytes, enc) {\n  bytes = utils_1$1.toArray(bytes, enc);\n\n  var len = this.p.byteLength();\n\n  // uncompressed, hybrid-odd, hybrid-even\n  if ((bytes[0] === 0x04 || bytes[0] === 0x06 || bytes[0] === 0x07) &&\n      bytes.length - 1 === 2 * len) {\n    if (bytes[0] === 0x06)\n      assert$1(bytes[bytes.length - 1] % 2 === 0);\n    else if (bytes[0] === 0x07)\n      assert$1(bytes[bytes.length - 1] % 2 === 1);\n\n    var res =  this.point(bytes.slice(1, 1 + len),\n                          bytes.slice(1 + len, 1 + 2 * len));\n\n    return res;\n  } else if ((bytes[0] === 0x02 || bytes[0] === 0x03) &&\n              bytes.length - 1 === len) {\n    return this.pointFromX(bytes.slice(1, 1 + len), bytes[0] === 0x03);\n  }\n  throw new Error('Unknown point format');\n};\n\nBasePoint.prototype.encodeCompressed = function encodeCompressed(enc) {\n  return this.encode(enc, true);\n};\n\nBasePoint.prototype._encode = function _encode(compact) {\n  var len = this.curve.p.byteLength();\n  var x = this.getX().toArray('be', len);\n\n  if (compact)\n    return [ this.getY().isEven() ? 0x02 : 0x03 ].concat(x);\n\n  return [ 0x04 ].concat(x, this.getY().toArray('be', len)) ;\n};\n\nBasePoint.prototype.encode = function encode(enc, compact) {\n  return utils_1$1.encode(this._encode(compact), enc);\n};\n\nBasePoint.prototype.precompute = function precompute(power) {\n  if (this.precomputed)\n    return this;\n\n  var precomputed = {\n    doubles: null,\n    naf: null,\n    beta: null\n  };\n  precomputed.naf = this._getNAFPoints(8);\n  precomputed.doubles = this._getDoubles(4, power);\n  precomputed.beta = this._getBeta();\n  this.precomputed = precomputed;\n\n  return this;\n};\n\nBasePoint.prototype._hasDoubles = function _hasDoubles(k) {\n  if (!this.precomputed)\n    return false;\n\n  var doubles = this.precomputed.doubles;\n  if (!doubles)\n    return false;\n\n  return doubles.points.length >= Math.ceil((k.bitLength() + 1) / doubles.step);\n};\n\nBasePoint.prototype._getDoubles = function _getDoubles(step, power) {\n  if (this.precomputed && this.precomputed.doubles)\n    return this.precomputed.doubles;\n\n  var doubles = [ this ];\n  var acc = this;\n  for (var i = 0; i < power; i += step) {\n    for (var j = 0; j < step; j++)\n      acc = acc.dbl();\n    doubles.push(acc);\n  }\n  return {\n    step: step,\n    points: doubles\n  };\n};\n\nBasePoint.prototype._getNAFPoints = function _getNAFPoints(wnd) {\n  if (this.precomputed && this.precomputed.naf)\n    return this.precomputed.naf;\n\n  var res = [ this ];\n  var max = (1 << wnd) - 1;\n  var dbl = max === 1 ? null : this.dbl();\n  for (var i = 1; i < max; i++)\n    res[i] = res[i - 1].add(dbl);\n  return {\n    wnd: wnd,\n    points: res\n  };\n};\n\nBasePoint.prototype._getBeta = function _getBeta() {\n  return null;\n};\n\nBasePoint.prototype.dblp = function dblp(k) {\n  var r = this;\n  for (var i = 0; i < k; i++)\n    r = r.dbl();\n  return r;\n};\n\nvar inherits_browser = createCommonjsModule(function (module) {\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor;\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor;\n      var TempCtor = function () {};\n      TempCtor.prototype = superCtor.prototype;\n      ctor.prototype = new TempCtor();\n      ctor.prototype.constructor = ctor;\n    }\n  };\n}\n});\n\n'use strict';\n\n\n\n\n\n\nvar assert$2 = utils_1$1.assert;\n\nfunction ShortCurve(conf) {\n  base.call(this, 'short', conf);\n\n  this.a = new BN(conf.a, 16).toRed(this.red);\n  this.b = new BN(conf.b, 16).toRed(this.red);\n  this.tinv = this.two.redInvm();\n\n  this.zeroA = this.a.fromRed().cmpn(0) === 0;\n  this.threeA = this.a.fromRed().sub(this.p).cmpn(-3) === 0;\n\n  // If the curve is endomorphic, precalculate beta and lambda\n  this.endo = this._getEndomorphism(conf);\n  this._endoWnafT1 = new Array(4);\n  this._endoWnafT2 = new Array(4);\n}\ninherits_browser(ShortCurve, base);\nvar short_1 = ShortCurve;\n\nShortCurve.prototype._getEndomorphism = function _getEndomorphism(conf) {\n  // No efficient endomorphism\n  if (!this.zeroA || !this.g || !this.n || this.p.modn(3) !== 1)\n    return;\n\n  // Compute beta and lambda, that lambda * P = (beta * Px; Py)\n  var beta;\n  var lambda;\n  if (conf.beta) {\n    beta = new BN(conf.beta, 16).toRed(this.red);\n  } else {\n    var betas = this._getEndoRoots(this.p);\n    // Choose the smallest beta\n    beta = betas[0].cmp(betas[1]) < 0 ? betas[0] : betas[1];\n    beta = beta.toRed(this.red);\n  }\n  if (conf.lambda) {\n    lambda = new BN(conf.lambda, 16);\n  } else {\n    // Choose the lambda that is matching selected beta\n    var lambdas = this._getEndoRoots(this.n);\n    if (this.g.mul(lambdas[0]).x.cmp(this.g.x.redMul(beta)) === 0) {\n      lambda = lambdas[0];\n    } else {\n      lambda = lambdas[1];\n      assert$2(this.g.mul(lambda).x.cmp(this.g.x.redMul(beta)) === 0);\n    }\n  }\n\n  // Get basis vectors, used for balanced length-two representation\n  var basis;\n  if (conf.basis) {\n    basis = conf.basis.map(function(vec) {\n      return {\n        a: new BN(vec.a, 16),\n        b: new BN(vec.b, 16)\n      };\n    });\n  } else {\n    basis = this._getEndoBasis(lambda);\n  }\n\n  return {\n    beta: beta,\n    lambda: lambda,\n    basis: basis\n  };\n};\n\nShortCurve.prototype._getEndoRoots = function _getEndoRoots(num) {\n  // Find roots of for x^2 + x + 1 in F\n  // Root = (-1 +- Sqrt(-3)) / 2\n  //\n  var red = num === this.p ? this.red : BN.mont(num);\n  var tinv = new BN(2).toRed(red).redInvm();\n  var ntinv = tinv.redNeg();\n\n  var s = new BN(3).toRed(red).redNeg().redSqrt().redMul(tinv);\n\n  var l1 = ntinv.redAdd(s).fromRed();\n  var l2 = ntinv.redSub(s).fromRed();\n  return [ l1, l2 ];\n};\n\nShortCurve.prototype._getEndoBasis = function _getEndoBasis(lambda) {\n  // aprxSqrt >= sqrt(this.n)\n  var aprxSqrt = this.n.ushrn(Math.floor(this.n.bitLength() / 2));\n\n  // 3.74\n  // Run EGCD, until r(L + 1) < aprxSqrt\n  var u = lambda;\n  var v = this.n.clone();\n  var x1 = new BN(1);\n  var y1 = new BN(0);\n  var x2 = new BN(0);\n  var y2 = new BN(1);\n\n  // NOTE: all vectors are roots of: a + b * lambda = 0 (mod n)\n  var a0;\n  var b0;\n  // First vector\n  var a1;\n  var b1;\n  // Second vector\n  var a2;\n  var b2;\n\n  var prevR;\n  var i = 0;\n  var r;\n  var x;\n  while (u.cmpn(0) !== 0) {\n    var q = v.div(u);\n    r = v.sub(q.mul(u));\n    x = x2.sub(q.mul(x1));\n    var y = y2.sub(q.mul(y1));\n\n    if (!a1 && r.cmp(aprxSqrt) < 0) {\n      a0 = prevR.neg();\n      b0 = x1;\n      a1 = r.neg();\n      b1 = x;\n    } else if (a1 && ++i === 2) {\n      break;\n    }\n    prevR = r;\n\n    v = u;\n    u = r;\n    x2 = x1;\n    x1 = x;\n    y2 = y1;\n    y1 = y;\n  }\n  a2 = r.neg();\n  b2 = x;\n\n  var len1 = a1.sqr().add(b1.sqr());\n  var len2 = a2.sqr().add(b2.sqr());\n  if (len2.cmp(len1) >= 0) {\n    a2 = a0;\n    b2 = b0;\n  }\n\n  // Normalize signs\n  if (a1.negative) {\n    a1 = a1.neg();\n    b1 = b1.neg();\n  }\n  if (a2.negative) {\n    a2 = a2.neg();\n    b2 = b2.neg();\n  }\n\n  return [\n    { a: a1, b: b1 },\n    { a: a2, b: b2 }\n  ];\n};\n\nShortCurve.prototype._endoSplit = function _endoSplit(k) {\n  var basis = this.endo.basis;\n  var v1 = basis[0];\n  var v2 = basis[1];\n\n  var c1 = v2.b.mul(k).divRound(this.n);\n  var c2 = v1.b.neg().mul(k).divRound(this.n);\n\n  var p1 = c1.mul(v1.a);\n  var p2 = c2.mul(v2.a);\n  var q1 = c1.mul(v1.b);\n  var q2 = c2.mul(v2.b);\n\n  // Calculate answer\n  var k1 = k.sub(p1).sub(p2);\n  var k2 = q1.add(q2).neg();\n  return { k1: k1, k2: k2 };\n};\n\nShortCurve.prototype.pointFromX = function pointFromX(x, odd) {\n  x = new BN(x, 16);\n  if (!x.red)\n    x = x.toRed(this.red);\n\n  var y2 = x.redSqr().redMul(x).redIAdd(x.redMul(this.a)).redIAdd(this.b);\n  var y = y2.redSqrt();\n  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0)\n    throw new Error('invalid point');\n\n  // XXX Is there any way to tell if the number is odd without converting it\n  // to non-red form?\n  var isOdd = y.fromRed().isOdd();\n  if (odd && !isOdd || !odd && isOdd)\n    y = y.redNeg();\n\n  return this.point(x, y);\n};\n\nShortCurve.prototype.validate = function validate(point) {\n  if (point.inf)\n    return true;\n\n  var x = point.x;\n  var y = point.y;\n\n  var ax = this.a.redMul(x);\n  var rhs = x.redSqr().redMul(x).redIAdd(ax).redIAdd(this.b);\n  return y.redSqr().redISub(rhs).cmpn(0) === 0;\n};\n\nShortCurve.prototype._endoWnafMulAdd =\n    function _endoWnafMulAdd(points, coeffs, jacobianResult) {\n  var npoints = this._endoWnafT1;\n  var ncoeffs = this._endoWnafT2;\n  for (var i = 0; i < points.length; i++) {\n    var split = this._endoSplit(coeffs[i]);\n    var p = points[i];\n    var beta = p._getBeta();\n\n    if (split.k1.negative) {\n      split.k1.ineg();\n      p = p.neg(true);\n    }\n    if (split.k2.negative) {\n      split.k2.ineg();\n      beta = beta.neg(true);\n    }\n\n    npoints[i * 2] = p;\n    npoints[i * 2 + 1] = beta;\n    ncoeffs[i * 2] = split.k1;\n    ncoeffs[i * 2 + 1] = split.k2;\n  }\n  var res = this._wnafMulAdd(1, npoints, ncoeffs, i * 2, jacobianResult);\n\n  // Clean-up references to points and coefficients\n  for (var j = 0; j < i * 2; j++) {\n    npoints[j] = null;\n    ncoeffs[j] = null;\n  }\n  return res;\n};\n\nfunction Point(curve, x, y, isRed) {\n  base.BasePoint.call(this, curve, 'affine');\n  if (x === null && y === null) {\n    this.x = null;\n    this.y = null;\n    this.inf = true;\n  } else {\n    this.x = new BN(x, 16);\n    this.y = new BN(y, 16);\n    // Force redgomery representation when loading from JSON\n    if (isRed) {\n      this.x.forceRed(this.curve.red);\n      this.y.forceRed(this.curve.red);\n    }\n    if (!this.x.red)\n      this.x = this.x.toRed(this.curve.red);\n    if (!this.y.red)\n      this.y = this.y.toRed(this.curve.red);\n    this.inf = false;\n  }\n}\ninherits_browser(Point, base.BasePoint);\n\nShortCurve.prototype.point = function point(x, y, isRed) {\n  return new Point(this, x, y, isRed);\n};\n\nShortCurve.prototype.pointFromJSON = function pointFromJSON(obj, red) {\n  return Point.fromJSON(this, obj, red);\n};\n\nPoint.prototype._getBeta = function _getBeta() {\n  if (!this.curve.endo)\n    return;\n\n  var pre = this.precomputed;\n  if (pre && pre.beta)\n    return pre.beta;\n\n  var beta = this.curve.point(this.x.redMul(this.curve.endo.beta), this.y);\n  if (pre) {\n    var curve = this.curve;\n    var endoMul = function(p) {\n      return curve.point(p.x.redMul(curve.endo.beta), p.y);\n    };\n    pre.beta = beta;\n    beta.precomputed = {\n      beta: null,\n      naf: pre.naf && {\n        wnd: pre.naf.wnd,\n        points: pre.naf.points.map(endoMul)\n      },\n      doubles: pre.doubles && {\n        step: pre.doubles.step,\n        points: pre.doubles.points.map(endoMul)\n      }\n    };\n  }\n  return beta;\n};\n\nPoint.prototype.toJSON = function toJSON() {\n  if (!this.precomputed)\n    return [ this.x, this.y ];\n\n  return [ this.x, this.y, this.precomputed && {\n    doubles: this.precomputed.doubles && {\n      step: this.precomputed.doubles.step,\n      points: this.precomputed.doubles.points.slice(1)\n    },\n    naf: this.precomputed.naf && {\n      wnd: this.precomputed.naf.wnd,\n      points: this.precomputed.naf.points.slice(1)\n    }\n  } ];\n};\n\nPoint.fromJSON = function fromJSON(curve, obj, red) {\n  if (typeof obj === 'string')\n    obj = JSON.parse(obj);\n  var res = curve.point(obj[0], obj[1], red);\n  if (!obj[2])\n    return res;\n\n  function obj2point(obj) {\n    return curve.point(obj[0], obj[1], red);\n  }\n\n  var pre = obj[2];\n  res.precomputed = {\n    beta: null,\n    doubles: pre.doubles && {\n      step: pre.doubles.step,\n      points: [ res ].concat(pre.doubles.points.map(obj2point))\n    },\n    naf: pre.naf && {\n      wnd: pre.naf.wnd,\n      points: [ res ].concat(pre.naf.points.map(obj2point))\n    }\n  };\n  return res;\n};\n\nPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity())\n    return '<EC Point Infinity>';\n  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +\n      ' y: ' + this.y.fromRed().toString(16, 2) + '>';\n};\n\nPoint.prototype.isInfinity = function isInfinity() {\n  return this.inf;\n};\n\nPoint.prototype.add = function add(p) {\n  // O + P = P\n  if (this.inf)\n    return p;\n\n  // P + O = P\n  if (p.inf)\n    return this;\n\n  // P + P = 2P\n  if (this.eq(p))\n    return this.dbl();\n\n  // P + (-P) = O\n  if (this.neg().eq(p))\n    return this.curve.point(null, null);\n\n  // P + Q = O\n  if (this.x.cmp(p.x) === 0)\n    return this.curve.point(null, null);\n\n  var c = this.y.redSub(p.y);\n  if (c.cmpn(0) !== 0)\n    c = c.redMul(this.x.redSub(p.x).redInvm());\n  var nx = c.redSqr().redISub(this.x).redISub(p.x);\n  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);\n  return this.curve.point(nx, ny);\n};\n\nPoint.prototype.dbl = function dbl() {\n  if (this.inf)\n    return this;\n\n  // 2P = O\n  var ys1 = this.y.redAdd(this.y);\n  if (ys1.cmpn(0) === 0)\n    return this.curve.point(null, null);\n\n  var a = this.curve.a;\n\n  var x2 = this.x.redSqr();\n  var dyinv = ys1.redInvm();\n  var c = x2.redAdd(x2).redIAdd(x2).redIAdd(a).redMul(dyinv);\n\n  var nx = c.redSqr().redISub(this.x.redAdd(this.x));\n  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);\n  return this.curve.point(nx, ny);\n};\n\nPoint.prototype.getX = function getX() {\n  return this.x.fromRed();\n};\n\nPoint.prototype.getY = function getY() {\n  return this.y.fromRed();\n};\n\nPoint.prototype.mul = function mul(k) {\n  k = new BN(k, 16);\n  if (this.isInfinity())\n    return this;\n  else if (this._hasDoubles(k))\n    return this.curve._fixedNafMul(this, k);\n  else if (this.curve.endo)\n    return this.curve._endoWnafMulAdd([ this ], [ k ]);\n  else\n    return this.curve._wnafMul(this, k);\n};\n\nPoint.prototype.mulAdd = function mulAdd(k1, p2, k2) {\n  var points = [ this, p2 ];\n  var coeffs = [ k1, k2 ];\n  if (this.curve.endo)\n    return this.curve._endoWnafMulAdd(points, coeffs);\n  else\n    return this.curve._wnafMulAdd(1, points, coeffs, 2);\n};\n\nPoint.prototype.jmulAdd = function jmulAdd(k1, p2, k2) {\n  var points = [ this, p2 ];\n  var coeffs = [ k1, k2 ];\n  if (this.curve.endo)\n    return this.curve._endoWnafMulAdd(points, coeffs, true);\n  else\n    return this.curve._wnafMulAdd(1, points, coeffs, 2, true);\n};\n\nPoint.prototype.eq = function eq(p) {\n  return this === p ||\n         this.inf === p.inf &&\n             (this.inf || this.x.cmp(p.x) === 0 && this.y.cmp(p.y) === 0);\n};\n\nPoint.prototype.neg = function neg(_precompute) {\n  if (this.inf)\n    return this;\n\n  var res = this.curve.point(this.x, this.y.redNeg());\n  if (_precompute && this.precomputed) {\n    var pre = this.precomputed;\n    var negate = function(p) {\n      return p.neg();\n    };\n    res.precomputed = {\n      naf: pre.naf && {\n        wnd: pre.naf.wnd,\n        points: pre.naf.points.map(negate)\n      },\n      doubles: pre.doubles && {\n        step: pre.doubles.step,\n        points: pre.doubles.points.map(negate)\n      }\n    };\n  }\n  return res;\n};\n\nPoint.prototype.toJ = function toJ() {\n  if (this.inf)\n    return this.curve.jpoint(null, null, null);\n\n  var res = this.curve.jpoint(this.x, this.y, this.curve.one);\n  return res;\n};\n\nfunction JPoint(curve, x, y, z) {\n  base.BasePoint.call(this, curve, 'jacobian');\n  if (x === null && y === null && z === null) {\n    this.x = this.curve.one;\n    this.y = this.curve.one;\n    this.z = new BN(0);\n  } else {\n    this.x = new BN(x, 16);\n    this.y = new BN(y, 16);\n    this.z = new BN(z, 16);\n  }\n  if (!this.x.red)\n    this.x = this.x.toRed(this.curve.red);\n  if (!this.y.red)\n    this.y = this.y.toRed(this.curve.red);\n  if (!this.z.red)\n    this.z = this.z.toRed(this.curve.red);\n\n  this.zOne = this.z === this.curve.one;\n}\ninherits_browser(JPoint, base.BasePoint);\n\nShortCurve.prototype.jpoint = function jpoint(x, y, z) {\n  return new JPoint(this, x, y, z);\n};\n\nJPoint.prototype.toP = function toP() {\n  if (this.isInfinity())\n    return this.curve.point(null, null);\n\n  var zinv = this.z.redInvm();\n  var zinv2 = zinv.redSqr();\n  var ax = this.x.redMul(zinv2);\n  var ay = this.y.redMul(zinv2).redMul(zinv);\n\n  return this.curve.point(ax, ay);\n};\n\nJPoint.prototype.neg = function neg() {\n  return this.curve.jpoint(this.x, this.y.redNeg(), this.z);\n};\n\nJPoint.prototype.add = function add(p) {\n  // O + P = P\n  if (this.isInfinity())\n    return p;\n\n  // P + O = P\n  if (p.isInfinity())\n    return this;\n\n  // 12M + 4S + 7A\n  var pz2 = p.z.redSqr();\n  var z2 = this.z.redSqr();\n  var u1 = this.x.redMul(pz2);\n  var u2 = p.x.redMul(z2);\n  var s1 = this.y.redMul(pz2.redMul(p.z));\n  var s2 = p.y.redMul(z2.redMul(this.z));\n\n  var h = u1.redSub(u2);\n  var r = s1.redSub(s2);\n  if (h.cmpn(0) === 0) {\n    if (r.cmpn(0) !== 0)\n      return this.curve.jpoint(null, null, null);\n    else\n      return this.dbl();\n  }\n\n  var h2 = h.redSqr();\n  var h3 = h2.redMul(h);\n  var v = u1.redMul(h2);\n\n  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);\n  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));\n  var nz = this.z.redMul(p.z).redMul(h);\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.mixedAdd = function mixedAdd(p) {\n  // O + P = P\n  if (this.isInfinity())\n    return p.toJ();\n\n  // P + O = P\n  if (p.isInfinity())\n    return this;\n\n  // 8M + 3S + 7A\n  var z2 = this.z.redSqr();\n  var u1 = this.x;\n  var u2 = p.x.redMul(z2);\n  var s1 = this.y;\n  var s2 = p.y.redMul(z2).redMul(this.z);\n\n  var h = u1.redSub(u2);\n  var r = s1.redSub(s2);\n  if (h.cmpn(0) === 0) {\n    if (r.cmpn(0) !== 0)\n      return this.curve.jpoint(null, null, null);\n    else\n      return this.dbl();\n  }\n\n  var h2 = h.redSqr();\n  var h3 = h2.redMul(h);\n  var v = u1.redMul(h2);\n\n  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);\n  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));\n  var nz = this.z.redMul(h);\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.dblp = function dblp(pow) {\n  if (pow === 0)\n    return this;\n  if (this.isInfinity())\n    return this;\n  if (!pow)\n    return this.dbl();\n\n  if (this.curve.zeroA || this.curve.threeA) {\n    var r = this;\n    for (var i = 0; i < pow; i++)\n      r = r.dbl();\n    return r;\n  }\n\n  // 1M + 2S + 1A + N * (4S + 5M + 8A)\n  // N = 1 => 6M + 6S + 9A\n  var a = this.curve.a;\n  var tinv = this.curve.tinv;\n\n  var jx = this.x;\n  var jy = this.y;\n  var jz = this.z;\n  var jz4 = jz.redSqr().redSqr();\n\n  // Reuse results\n  var jyd = jy.redAdd(jy);\n  for (var i = 0; i < pow; i++) {\n    var jx2 = jx.redSqr();\n    var jyd2 = jyd.redSqr();\n    var jyd4 = jyd2.redSqr();\n    var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));\n\n    var t1 = jx.redMul(jyd2);\n    var nx = c.redSqr().redISub(t1.redAdd(t1));\n    var t2 = t1.redISub(nx);\n    var dny = c.redMul(t2);\n    dny = dny.redIAdd(dny).redISub(jyd4);\n    var nz = jyd.redMul(jz);\n    if (i + 1 < pow)\n      jz4 = jz4.redMul(jyd4);\n\n    jx = nx;\n    jz = nz;\n    jyd = dny;\n  }\n\n  return this.curve.jpoint(jx, jyd.redMul(tinv), jz);\n};\n\nJPoint.prototype.dbl = function dbl() {\n  if (this.isInfinity())\n    return this;\n\n  if (this.curve.zeroA)\n    return this._zeroDbl();\n  else if (this.curve.threeA)\n    return this._threeDbl();\n  else\n    return this._dbl();\n};\n\nJPoint.prototype._zeroDbl = function _zeroDbl() {\n  var nx;\n  var ny;\n  var nz;\n  // Z = 1\n  if (this.zOne) {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html\n    //     #doubling-mdbl-2007-bl\n    // 1M + 5S + 14A\n\n    // XX = X1^2\n    var xx = this.x.redSqr();\n    // YY = Y1^2\n    var yy = this.y.redSqr();\n    // YYYY = YY^2\n    var yyyy = yy.redSqr();\n    // S = 2 * ((X1 + YY)^2 - XX - YYYY)\n    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n    s = s.redIAdd(s);\n    // M = 3 * XX + a; a = 0\n    var m = xx.redAdd(xx).redIAdd(xx);\n    // T = M ^ 2 - 2*S\n    var t = m.redSqr().redISub(s).redISub(s);\n\n    // 8 * YYYY\n    var yyyy8 = yyyy.redIAdd(yyyy);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n\n    // X3 = T\n    nx = t;\n    // Y3 = M * (S - T) - 8 * YYYY\n    ny = m.redMul(s.redISub(t)).redISub(yyyy8);\n    // Z3 = 2*Y1\n    nz = this.y.redAdd(this.y);\n  } else {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html\n    //     #doubling-dbl-2009-l\n    // 2M + 5S + 13A\n\n    // A = X1^2\n    var a = this.x.redSqr();\n    // B = Y1^2\n    var b = this.y.redSqr();\n    // C = B^2\n    var c = b.redSqr();\n    // D = 2 * ((X1 + B)^2 - A - C)\n    var d = this.x.redAdd(b).redSqr().redISub(a).redISub(c);\n    d = d.redIAdd(d);\n    // E = 3 * A\n    var e = a.redAdd(a).redIAdd(a);\n    // F = E^2\n    var f = e.redSqr();\n\n    // 8 * C\n    var c8 = c.redIAdd(c);\n    c8 = c8.redIAdd(c8);\n    c8 = c8.redIAdd(c8);\n\n    // X3 = F - 2 * D\n    nx = f.redISub(d).redISub(d);\n    // Y3 = E * (D - X3) - 8 * C\n    ny = e.redMul(d.redISub(nx)).redISub(c8);\n    // Z3 = 2 * Y1 * Z1\n    nz = this.y.redMul(this.z);\n    nz = nz.redIAdd(nz);\n  }\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype._threeDbl = function _threeDbl() {\n  var nx;\n  var ny;\n  var nz;\n  // Z = 1\n  if (this.zOne) {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html\n    //     #doubling-mdbl-2007-bl\n    // 1M + 5S + 15A\n\n    // XX = X1^2\n    var xx = this.x.redSqr();\n    // YY = Y1^2\n    var yy = this.y.redSqr();\n    // YYYY = YY^2\n    var yyyy = yy.redSqr();\n    // S = 2 * ((X1 + YY)^2 - XX - YYYY)\n    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n    s = s.redIAdd(s);\n    // M = 3 * XX + a\n    var m = xx.redAdd(xx).redIAdd(xx).redIAdd(this.curve.a);\n    // T = M^2 - 2 * S\n    var t = m.redSqr().redISub(s).redISub(s);\n    // X3 = T\n    nx = t;\n    // Y3 = M * (S - T) - 8 * YYYY\n    var yyyy8 = yyyy.redIAdd(yyyy);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    ny = m.redMul(s.redISub(t)).redISub(yyyy8);\n    // Z3 = 2 * Y1\n    nz = this.y.redAdd(this.y);\n  } else {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html#doubling-dbl-2001-b\n    // 3M + 5S\n\n    // delta = Z1^2\n    var delta = this.z.redSqr();\n    // gamma = Y1^2\n    var gamma = this.y.redSqr();\n    // beta = X1 * gamma\n    var beta = this.x.redMul(gamma);\n    // alpha = 3 * (X1 - delta) * (X1 + delta)\n    var alpha = this.x.redSub(delta).redMul(this.x.redAdd(delta));\n    alpha = alpha.redAdd(alpha).redIAdd(alpha);\n    // X3 = alpha^2 - 8 * beta\n    var beta4 = beta.redIAdd(beta);\n    beta4 = beta4.redIAdd(beta4);\n    var beta8 = beta4.redAdd(beta4);\n    nx = alpha.redSqr().redISub(beta8);\n    // Z3 = (Y1 + Z1)^2 - gamma - delta\n    nz = this.y.redAdd(this.z).redSqr().redISub(gamma).redISub(delta);\n    // Y3 = alpha * (4 * beta - X3) - 8 * gamma^2\n    var ggamma8 = gamma.redSqr();\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ny = alpha.redMul(beta4.redISub(nx)).redISub(ggamma8);\n  }\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype._dbl = function _dbl() {\n  var a = this.curve.a;\n\n  // 4M + 6S + 10A\n  var jx = this.x;\n  var jy = this.y;\n  var jz = this.z;\n  var jz4 = jz.redSqr().redSqr();\n\n  var jx2 = jx.redSqr();\n  var jy2 = jy.redSqr();\n\n  var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));\n\n  var jxd4 = jx.redAdd(jx);\n  jxd4 = jxd4.redIAdd(jxd4);\n  var t1 = jxd4.redMul(jy2);\n  var nx = c.redSqr().redISub(t1.redAdd(t1));\n  var t2 = t1.redISub(nx);\n\n  var jyd8 = jy2.redSqr();\n  jyd8 = jyd8.redIAdd(jyd8);\n  jyd8 = jyd8.redIAdd(jyd8);\n  jyd8 = jyd8.redIAdd(jyd8);\n  var ny = c.redMul(t2).redISub(jyd8);\n  var nz = jy.redAdd(jy).redMul(jz);\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.trpl = function trpl() {\n  if (!this.curve.zeroA)\n    return this.dbl().add(this);\n\n  // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#tripling-tpl-2007-bl\n  // 5M + 10S + ...\n\n  // XX = X1^2\n  var xx = this.x.redSqr();\n  // YY = Y1^2\n  var yy = this.y.redSqr();\n  // ZZ = Z1^2\n  var zz = this.z.redSqr();\n  // YYYY = YY^2\n  var yyyy = yy.redSqr();\n  // M = 3 * XX + a * ZZ2; a = 0\n  var m = xx.redAdd(xx).redIAdd(xx);\n  // MM = M^2\n  var mm = m.redSqr();\n  // E = 6 * ((X1 + YY)^2 - XX - YYYY) - MM\n  var e = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n  e = e.redIAdd(e);\n  e = e.redAdd(e).redIAdd(e);\n  e = e.redISub(mm);\n  // EE = E^2\n  var ee = e.redSqr();\n  // T = 16*YYYY\n  var t = yyyy.redIAdd(yyyy);\n  t = t.redIAdd(t);\n  t = t.redIAdd(t);\n  t = t.redIAdd(t);\n  // U = (M + E)^2 - MM - EE - T\n  var u = m.redIAdd(e).redSqr().redISub(mm).redISub(ee).redISub(t);\n  // X3 = 4 * (X1 * EE - 4 * YY * U)\n  var yyu4 = yy.redMul(u);\n  yyu4 = yyu4.redIAdd(yyu4);\n  yyu4 = yyu4.redIAdd(yyu4);\n  var nx = this.x.redMul(ee).redISub(yyu4);\n  nx = nx.redIAdd(nx);\n  nx = nx.redIAdd(nx);\n  // Y3 = 8 * Y1 * (U * (T - U) - E * EE)\n  var ny = this.y.redMul(u.redMul(t.redISub(u)).redISub(e.redMul(ee)));\n  ny = ny.redIAdd(ny);\n  ny = ny.redIAdd(ny);\n  ny = ny.redIAdd(ny);\n  // Z3 = (Z1 + E)^2 - ZZ - EE\n  var nz = this.z.redAdd(e).redSqr().redISub(zz).redISub(ee);\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.mul = function mul(k, kbase) {\n  k = new BN(k, kbase);\n\n  return this.curve._wnafMul(this, k);\n};\n\nJPoint.prototype.eq = function eq(p) {\n  if (p.type === 'affine')\n    return this.eq(p.toJ());\n\n  if (this === p)\n    return true;\n\n  // x1 * z2^2 == x2 * z1^2\n  var z2 = this.z.redSqr();\n  var pz2 = p.z.redSqr();\n  if (this.x.redMul(pz2).redISub(p.x.redMul(z2)).cmpn(0) !== 0)\n    return false;\n\n  // y1 * z2^3 == y2 * z1^3\n  var z3 = z2.redMul(this.z);\n  var pz3 = pz2.redMul(p.z);\n  return this.y.redMul(pz3).redISub(p.y.redMul(z3)).cmpn(0) === 0;\n};\n\nJPoint.prototype.eqXToP = function eqXToP(x) {\n  var zs = this.z.redSqr();\n  var rx = x.toRed(this.curve.red).redMul(zs);\n  if (this.x.cmp(rx) === 0)\n    return true;\n\n  var xc = x.clone();\n  var t = this.curve.redN.redMul(zs);\n  for (;;) {\n    xc.iadd(this.curve.n);\n    if (xc.cmp(this.curve.p) >= 0)\n      return false;\n\n    rx.redIAdd(t);\n    if (this.x.cmp(rx) === 0)\n      return true;\n  }\n};\n\nJPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity())\n    return '<EC JPoint Infinity>';\n  return '<EC JPoint x: ' + this.x.toString(16, 2) +\n      ' y: ' + this.y.toString(16, 2) +\n      ' z: ' + this.z.toString(16, 2) + '>';\n};\n\nJPoint.prototype.isInfinity = function isInfinity() {\n  // XXX This code assumes that zero is always zero in red\n  return this.z.cmpn(0) === 0;\n};\n\nvar curve_1 = createCommonjsModule(function (module, exports) {\n'use strict';\n\nvar curve = exports;\n\ncurve.base = base;\ncurve.short = short_1;\ncurve.mont = /*RicMoo:ethers:require(./mont)*/(null);\ncurve.edwards = /*RicMoo:ethers:require(./edwards)*/(null);\n});\n\nvar curves_1 = createCommonjsModule(function (module, exports) {\n'use strict';\n\nvar curves = exports;\n\n\n\n\n\nvar assert = utils_1$1.assert;\n\nfunction PresetCurve(options) {\n  if (options.type === 'short')\n    this.curve = new curve_1.short(options);\n  else if (options.type === 'edwards')\n    this.curve = new curve_1.edwards(options);\n  else\n    this.curve = new curve_1.mont(options);\n  this.g = this.curve.g;\n  this.n = this.curve.n;\n  this.hash = options.hash;\n\n  assert(this.g.validate(), 'Invalid curve');\n  assert(this.g.mul(this.n).isInfinity(), 'Invalid curve, G*N != O');\n}\ncurves.PresetCurve = PresetCurve;\n\nfunction defineCurve(name, options) {\n  Object.defineProperty(curves, name, {\n    configurable: true,\n    enumerable: true,\n    get: function() {\n      var curve = new PresetCurve(options);\n      Object.defineProperty(curves, name, {\n        configurable: true,\n        enumerable: true,\n        value: curve\n      });\n      return curve;\n    }\n  });\n}\n\ndefineCurve('p192', {\n  type: 'short',\n  prime: 'p192',\n  p: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff',\n  a: 'ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc',\n  b: '64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1',\n  n: 'ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    '188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012',\n    '07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811'\n  ]\n});\n\ndefineCurve('p224', {\n  type: 'short',\n  prime: 'p224',\n  p: 'ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001',\n  a: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe',\n  b: 'b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4',\n  n: 'ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    'b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21',\n    'bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34'\n  ]\n});\n\ndefineCurve('p256', {\n  type: 'short',\n  prime: null,\n  p: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff',\n  a: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc',\n  b: '5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b',\n  n: 'ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    '6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296',\n    '4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5'\n  ]\n});\n\ndefineCurve('p384', {\n  type: 'short',\n  prime: null,\n  p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'fffffffe ffffffff 00000000 00000000 ffffffff',\n  a: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'fffffffe ffffffff 00000000 00000000 fffffffc',\n  b: 'b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f ' +\n     '5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef',\n  n: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 ' +\n     'f4372ddf 581a0db2 48b0a77a ecec196a ccc52973',\n  hash: hash.sha384,\n  gRed: false,\n  g: [\n    'aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 ' +\n    '5502f25d bf55296c 3a545e38 72760ab7',\n    '3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 ' +\n    '0a60b1ce 1d7e819d 7a431d7c 90ea0e5f'\n  ]\n});\n\ndefineCurve('p521', {\n  type: 'short',\n  prime: null,\n  p: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff ffffffff ffffffff ffffffff',\n  a: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff ffffffff ffffffff fffffffc',\n  b: '00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b ' +\n     '99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd ' +\n     '3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00',\n  n: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 ' +\n     'f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409',\n  hash: hash.sha512,\n  gRed: false,\n  g: [\n    '000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 ' +\n    '053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 ' +\n    'a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66',\n    '00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 ' +\n    '579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 ' +\n    '3fad0761 353c7086 a272c240 88be9476 9fd16650'\n  ]\n});\n\ndefineCurve('curve25519', {\n  type: 'mont',\n  prime: 'p25519',\n  p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',\n  a: '76d06',\n  b: '1',\n  n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    '9'\n  ]\n});\n\ndefineCurve('ed25519', {\n  type: 'edwards',\n  prime: 'p25519',\n  p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',\n  a: '-1',\n  c: '1',\n  // -121665 * (121666^(-1)) (mod P)\n  d: '52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3',\n  n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    '216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a',\n\n    // 4/5\n    '6666666666666666666666666666666666666666666666666666666666666658'\n  ]\n});\n\nvar pre;\ntry {\n  pre = /*RicMoo:ethers:require(./precomputed/secp256k1)*/(null).crash();\n} catch (e) {\n  pre = undefined;\n}\n\ndefineCurve('secp256k1', {\n  type: 'short',\n  prime: 'k256',\n  p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f',\n  a: '0',\n  b: '7',\n  n: 'ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141',\n  h: '1',\n  hash: hash.sha256,\n\n  // Precomputed endomorphism\n  beta: '7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee',\n  lambda: '5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72',\n  basis: [\n    {\n      a: '3086d221a7d46bcde86c90e49284eb15',\n      b: '-e4437ed6010e88286f547fa90abfe4c3'\n    },\n    {\n      a: '114ca50f7a8e2f3f657c1108d9d44cfd8',\n      b: '3086d221a7d46bcde86c90e49284eb15'\n    }\n  ],\n\n  gRed: false,\n  g: [\n    '79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798',\n    '483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8',\n    pre\n  ]\n});\n});\n\n'use strict';\n\n\n\n\n\nfunction HmacDRBG(options) {\n  if (!(this instanceof HmacDRBG))\n    return new HmacDRBG(options);\n  this.hash = options.hash;\n  this.predResist = !!options.predResist;\n\n  this.outLen = this.hash.outSize;\n  this.minEntropy = options.minEntropy || this.hash.hmacStrength;\n\n  this._reseed = null;\n  this.reseedInterval = null;\n  this.K = null;\n  this.V = null;\n\n  var entropy = utils_1.toArray(options.entropy, options.entropyEnc || 'hex');\n  var nonce = utils_1.toArray(options.nonce, options.nonceEnc || 'hex');\n  var pers = utils_1.toArray(options.pers, options.persEnc || 'hex');\n  minimalisticAssert(entropy.length >= (this.minEntropy / 8),\n         'Not enough entropy. Minimum is: ' + this.minEntropy + ' bits');\n  this._init(entropy, nonce, pers);\n}\nvar hmacDrbg = HmacDRBG;\n\nHmacDRBG.prototype._init = function init(entropy, nonce, pers) {\n  var seed = entropy.concat(nonce).concat(pers);\n\n  this.K = new Array(this.outLen / 8);\n  this.V = new Array(this.outLen / 8);\n  for (var i = 0; i < this.V.length; i++) {\n    this.K[i] = 0x00;\n    this.V[i] = 0x01;\n  }\n\n  this._update(seed);\n  this._reseed = 1;\n  this.reseedInterval = 0x1000000000000;  // 2^48\n};\n\nHmacDRBG.prototype._hmac = function hmac() {\n  return new hash.hmac(this.hash, this.K);\n};\n\nHmacDRBG.prototype._update = function update(seed) {\n  var kmac = this._hmac()\n                 .update(this.V)\n                 .update([ 0x00 ]);\n  if (seed)\n    kmac = kmac.update(seed);\n  this.K = kmac.digest();\n  this.V = this._hmac().update(this.V).digest();\n  if (!seed)\n    return;\n\n  this.K = this._hmac()\n               .update(this.V)\n               .update([ 0x01 ])\n               .update(seed)\n               .digest();\n  this.V = this._hmac().update(this.V).digest();\n};\n\nHmacDRBG.prototype.reseed = function reseed(entropy, entropyEnc, add, addEnc) {\n  // Optional entropy enc\n  if (typeof entropyEnc !== 'string') {\n    addEnc = add;\n    add = entropyEnc;\n    entropyEnc = null;\n  }\n\n  entropy = utils_1.toArray(entropy, entropyEnc);\n  add = utils_1.toArray(add, addEnc);\n\n  minimalisticAssert(entropy.length >= (this.minEntropy / 8),\n         'Not enough entropy. Minimum is: ' + this.minEntropy + ' bits');\n\n  this._update(entropy.concat(add || []));\n  this._reseed = 1;\n};\n\nHmacDRBG.prototype.generate = function generate(len, enc, add, addEnc) {\n  if (this._reseed > this.reseedInterval)\n    throw new Error('Reseed is required');\n\n  // Optional encoding\n  if (typeof enc !== 'string') {\n    addEnc = add;\n    add = enc;\n    enc = null;\n  }\n\n  // Optional additional data\n  if (add) {\n    add = utils_1.toArray(add, addEnc || 'hex');\n    this._update(add);\n  }\n\n  var temp = [];\n  while (temp.length < len) {\n    this.V = this._hmac().update(this.V).digest();\n    temp = temp.concat(this.V);\n  }\n\n  var res = temp.slice(0, len);\n  this._update(add);\n  this._reseed++;\n  return utils_1.encode(res, enc);\n};\n\n'use strict';\n\n\n\nvar assert$3 = utils_1$1.assert;\n\nfunction KeyPair(ec, options) {\n  this.ec = ec;\n  this.priv = null;\n  this.pub = null;\n\n  // KeyPair(ec, { priv: ..., pub: ... })\n  if (options.priv)\n    this._importPrivate(options.priv, options.privEnc);\n  if (options.pub)\n    this._importPublic(options.pub, options.pubEnc);\n}\nvar key = KeyPair;\n\nKeyPair.fromPublic = function fromPublic(ec, pub, enc) {\n  if (pub instanceof KeyPair)\n    return pub;\n\n  return new KeyPair(ec, {\n    pub: pub,\n    pubEnc: enc\n  });\n};\n\nKeyPair.fromPrivate = function fromPrivate(ec, priv, enc) {\n  if (priv instanceof KeyPair)\n    return priv;\n\n  return new KeyPair(ec, {\n    priv: priv,\n    privEnc: enc\n  });\n};\n\nKeyPair.prototype.validate = function validate() {\n  var pub = this.getPublic();\n\n  if (pub.isInfinity())\n    return { result: false, reason: 'Invalid public key' };\n  if (!pub.validate())\n    return { result: false, reason: 'Public key is not a point' };\n  if (!pub.mul(this.ec.curve.n).isInfinity())\n    return { result: false, reason: 'Public key * N != O' };\n\n  return { result: true, reason: null };\n};\n\nKeyPair.prototype.getPublic = function getPublic(compact, enc) {\n  // compact is optional argument\n  if (typeof compact === 'string') {\n    enc = compact;\n    compact = null;\n  }\n\n  if (!this.pub)\n    this.pub = this.ec.g.mul(this.priv);\n\n  if (!enc)\n    return this.pub;\n\n  return this.pub.encode(enc, compact);\n};\n\nKeyPair.prototype.getPrivate = function getPrivate(enc) {\n  if (enc === 'hex')\n    return this.priv.toString(16, 2);\n  else\n    return this.priv;\n};\n\nKeyPair.prototype._importPrivate = function _importPrivate(key, enc) {\n  this.priv = new BN(key, enc || 16);\n\n  // Ensure that the priv won't be bigger than n, otherwise we may fail\n  // in fixed multiplication method\n  this.priv = this.priv.umod(this.ec.curve.n);\n};\n\nKeyPair.prototype._importPublic = function _importPublic(key, enc) {\n  if (key.x || key.y) {\n    // Montgomery points only have an `x` coordinate.\n    // Weierstrass/Edwards points on the other hand have both `x` and\n    // `y` coordinates.\n    if (this.ec.curve.type === 'mont') {\n      assert$3(key.x, 'Need x coordinate');\n    } else if (this.ec.curve.type === 'short' ||\n               this.ec.curve.type === 'edwards') {\n      assert$3(key.x && key.y, 'Need both x and y coordinate');\n    }\n    this.pub = this.ec.curve.point(key.x, key.y);\n    return;\n  }\n  this.pub = this.ec.curve.decodePoint(key, enc);\n};\n\n// ECDH\nKeyPair.prototype.derive = function derive(pub) {\n  return pub.mul(this.priv).getX();\n};\n\n// ECDSA\nKeyPair.prototype.sign = function sign(msg, enc, options) {\n  return this.ec.sign(msg, this, enc, options);\n};\n\nKeyPair.prototype.verify = function verify(msg, signature) {\n  return this.ec.verify(msg, signature, this);\n};\n\nKeyPair.prototype.inspect = function inspect() {\n  return '<Key priv: ' + (this.priv && this.priv.toString(16, 2)) +\n         ' pub: ' + (this.pub && this.pub.inspect()) + ' >';\n};\n\n'use strict';\n\n\n\n\nvar assert$4 = utils_1$1.assert;\n\nfunction Signature(options, enc) {\n  if (options instanceof Signature)\n    return options;\n\n  if (this._importDER(options, enc))\n    return;\n\n  assert$4(options.r && options.s, 'Signature without r or s');\n  this.r = new BN(options.r, 16);\n  this.s = new BN(options.s, 16);\n  if (options.recoveryParam === undefined)\n    this.recoveryParam = null;\n  else\n    this.recoveryParam = options.recoveryParam;\n}\nvar signature = Signature;\n\nfunction Position() {\n  this.place = 0;\n}\n\nfunction getLength(buf, p) {\n  var initial = buf[p.place++];\n  if (!(initial & 0x80)) {\n    return initial;\n  }\n  var octetLen = initial & 0xf;\n\n  // Indefinite length or overflow\n  if (octetLen === 0 || octetLen > 4) {\n    return false;\n  }\n\n  var val = 0;\n  for (var i = 0, off = p.place; i < octetLen; i++, off++) {\n    val <<= 8;\n    val |= buf[off];\n    val >>>= 0;\n  }\n\n  // Leading zeroes\n  if (val <= 0x7f) {\n    return false;\n  }\n\n  p.place = off;\n  return val;\n}\n\nfunction rmPadding(buf) {\n  var i = 0;\n  var len = buf.length - 1;\n  while (!buf[i] && !(buf[i + 1] & 0x80) && i < len) {\n    i++;\n  }\n  if (i === 0) {\n    return buf;\n  }\n  return buf.slice(i);\n}\n\nSignature.prototype._importDER = function _importDER(data, enc) {\n  data = utils_1$1.toArray(data, enc);\n  var p = new Position();\n  if (data[p.place++] !== 0x30) {\n    return false;\n  }\n  var len = getLength(data, p);\n  if (len === false) {\n    return false;\n  }\n  if ((len + p.place) !== data.length) {\n    return false;\n  }\n  if (data[p.place++] !== 0x02) {\n    return false;\n  }\n  var rlen = getLength(data, p);\n  if (rlen === false) {\n    return false;\n  }\n  var r = data.slice(p.place, rlen + p.place);\n  p.place += rlen;\n  if (data[p.place++] !== 0x02) {\n    return false;\n  }\n  var slen = getLength(data, p);\n  if (slen === false) {\n    return false;\n  }\n  if (data.length !== slen + p.place) {\n    return false;\n  }\n  var s = data.slice(p.place, slen + p.place);\n  if (r[0] === 0) {\n    if (r[1] & 0x80) {\n      r = r.slice(1);\n    } else {\n      // Leading zeroes\n      return false;\n    }\n  }\n  if (s[0] === 0) {\n    if (s[1] & 0x80) {\n      s = s.slice(1);\n    } else {\n      // Leading zeroes\n      return false;\n    }\n  }\n\n  this.r = new BN(r);\n  this.s = new BN(s);\n  this.recoveryParam = null;\n\n  return true;\n};\n\nfunction constructLength(arr, len) {\n  if (len < 0x80) {\n    arr.push(len);\n    return;\n  }\n  var octets = 1 + (Math.log(len) / Math.LN2 >>> 3);\n  arr.push(octets | 0x80);\n  while (--octets) {\n    arr.push((len >>> (octets << 3)) & 0xff);\n  }\n  arr.push(len);\n}\n\nSignature.prototype.toDER = function toDER(enc) {\n  var r = this.r.toArray();\n  var s = this.s.toArray();\n\n  // Pad values\n  if (r[0] & 0x80)\n    r = [ 0 ].concat(r);\n  // Pad values\n  if (s[0] & 0x80)\n    s = [ 0 ].concat(s);\n\n  r = rmPadding(r);\n  s = rmPadding(s);\n\n  while (!s[0] && !(s[1] & 0x80)) {\n    s = s.slice(1);\n  }\n  var arr = [ 0x02 ];\n  constructLength(arr, r.length);\n  arr = arr.concat(r);\n  arr.push(0x02);\n  constructLength(arr, s.length);\n  var backHalf = arr.concat(s);\n  var res = [ 0x30 ];\n  constructLength(res, backHalf.length);\n  res = res.concat(backHalf);\n  return utils_1$1.encode(res, enc);\n};\n\n'use strict';\n\n\n\n\n\nvar rand = /*RicMoo:ethers:require(brorand)*/(function() { throw new Error('unsupported'); });\nvar assert$5 = utils_1$1.assert;\n\n\n\n\nfunction EC(options) {\n  if (!(this instanceof EC))\n    return new EC(options);\n\n  // Shortcut `elliptic.ec(curve-name)`\n  if (typeof options === 'string') {\n    assert$5(curves_1.hasOwnProperty(options), 'Unknown curve ' + options);\n\n    options = curves_1[options];\n  }\n\n  // Shortcut for `elliptic.ec(elliptic.curves.curveName)`\n  if (options instanceof curves_1.PresetCurve)\n    options = { curve: options };\n\n  this.curve = options.curve.curve;\n  this.n = this.curve.n;\n  this.nh = this.n.ushrn(1);\n  this.g = this.curve.g;\n\n  // Point on curve\n  this.g = options.curve.g;\n  this.g.precompute(options.curve.n.bitLength() + 1);\n\n  // Hash for function for DRBG\n  this.hash = options.hash || options.curve.hash;\n}\nvar ec = EC;\n\nEC.prototype.keyPair = function keyPair(options) {\n  return new key(this, options);\n};\n\nEC.prototype.keyFromPrivate = function keyFromPrivate(priv, enc) {\n  return key.fromPrivate(this, priv, enc);\n};\n\nEC.prototype.keyFromPublic = function keyFromPublic(pub, enc) {\n  return key.fromPublic(this, pub, enc);\n};\n\nEC.prototype.genKeyPair = function genKeyPair(options) {\n  if (!options)\n    options = {};\n\n  // Instantiate Hmac_DRBG\n  var drbg = new hmacDrbg({\n    hash: this.hash,\n    pers: options.pers,\n    persEnc: options.persEnc || 'utf8',\n    entropy: options.entropy || rand(this.hash.hmacStrength),\n    entropyEnc: options.entropy && options.entropyEnc || 'utf8',\n    nonce: this.n.toArray()\n  });\n\n  var bytes = this.n.byteLength();\n  var ns2 = this.n.sub(new BN(2));\n  do {\n    var priv = new BN(drbg.generate(bytes));\n    if (priv.cmp(ns2) > 0)\n      continue;\n\n    priv.iaddn(1);\n    return this.keyFromPrivate(priv);\n  } while (true);\n};\n\nEC.prototype._truncateToN = function truncateToN(msg, truncOnly) {\n  var delta = msg.byteLength() * 8 - this.n.bitLength();\n  if (delta > 0)\n    msg = msg.ushrn(delta);\n  if (!truncOnly && msg.cmp(this.n) >= 0)\n    return msg.sub(this.n);\n  else\n    return msg;\n};\n\nEC.prototype.sign = function sign(msg, key, enc, options) {\n  if (typeof enc === 'object') {\n    options = enc;\n    enc = null;\n  }\n  if (!options)\n    options = {};\n\n  key = this.keyFromPrivate(key, enc);\n  msg = this._truncateToN(new BN(msg, 16));\n\n  // Zero-extend key to provide enough entropy\n  var bytes = this.n.byteLength();\n  var bkey = key.getPrivate().toArray('be', bytes);\n\n  // Zero-extend nonce to have the same byte size as N\n  var nonce = msg.toArray('be', bytes);\n\n  // Instantiate Hmac_DRBG\n  var drbg = new hmacDrbg({\n    hash: this.hash,\n    entropy: bkey,\n    nonce: nonce,\n    pers: options.pers,\n    persEnc: options.persEnc || 'utf8'\n  });\n\n  // Number of bytes to generate\n  var ns1 = this.n.sub(new BN(1));\n\n  for (var iter = 0; true; iter++) {\n    var k = options.k ?\n        options.k(iter) :\n        new BN(drbg.generate(this.n.byteLength()));\n    k = this._truncateToN(k, true);\n    if (k.cmpn(1) <= 0 || k.cmp(ns1) >= 0)\n      continue;\n\n    var kp = this.g.mul(k);\n    if (kp.isInfinity())\n      continue;\n\n    var kpX = kp.getX();\n    var r = kpX.umod(this.n);\n    if (r.cmpn(0) === 0)\n      continue;\n\n    var s = k.invm(this.n).mul(r.mul(key.getPrivate()).iadd(msg));\n    s = s.umod(this.n);\n    if (s.cmpn(0) === 0)\n      continue;\n\n    var recoveryParam = (kp.getY().isOdd() ? 1 : 0) |\n                        (kpX.cmp(r) !== 0 ? 2 : 0);\n\n    // Use complement of `s`, if it is > `n / 2`\n    if (options.canonical && s.cmp(this.nh) > 0) {\n      s = this.n.sub(s);\n      recoveryParam ^= 1;\n    }\n\n    return new signature({ r: r, s: s, recoveryParam: recoveryParam });\n  }\n};\n\nEC.prototype.verify = function verify(msg, signature$1, key, enc) {\n  msg = this._truncateToN(new BN(msg, 16));\n  key = this.keyFromPublic(key, enc);\n  signature$1 = new signature(signature$1, 'hex');\n\n  // Perform primitive values validation\n  var r = signature$1.r;\n  var s = signature$1.s;\n  if (r.cmpn(1) < 0 || r.cmp(this.n) >= 0)\n    return false;\n  if (s.cmpn(1) < 0 || s.cmp(this.n) >= 0)\n    return false;\n\n  // Validate signature\n  var sinv = s.invm(this.n);\n  var u1 = sinv.mul(msg).umod(this.n);\n  var u2 = sinv.mul(r).umod(this.n);\n\n  if (!this.curve._maxwellTrick) {\n    var p = this.g.mulAdd(u1, key.getPublic(), u2);\n    if (p.isInfinity())\n      return false;\n\n    return p.getX().umod(this.n).cmp(r) === 0;\n  }\n\n  // NOTE: Greg Maxwell's trick, inspired by:\n  // https://git.io/vad3K\n\n  var p = this.g.jmulAdd(u1, key.getPublic(), u2);\n  if (p.isInfinity())\n    return false;\n\n  // Compare `p.x` of Jacobian point with `r`,\n  // this will do `p.x == r * p.z^2` instead of multiplying `p.x` by the\n  // inverse of `p.z^2`\n  return p.eqXToP(r);\n};\n\nEC.prototype.recoverPubKey = function(msg, signature$1, j, enc) {\n  assert$5((3 & j) === j, 'The recovery param is more than two bits');\n  signature$1 = new signature(signature$1, enc);\n\n  var n = this.n;\n  var e = new BN(msg);\n  var r = signature$1.r;\n  var s = signature$1.s;\n\n  // A set LSB signifies that the y-coordinate is odd\n  var isYOdd = j & 1;\n  var isSecondKey = j >> 1;\n  if (r.cmp(this.curve.p.umod(this.curve.n)) >= 0 && isSecondKey)\n    throw new Error('Unable to find sencond key candinate');\n\n  // 1.1. Let x = r + jn.\n  if (isSecondKey)\n    r = this.curve.pointFromX(r.add(this.curve.n), isYOdd);\n  else\n    r = this.curve.pointFromX(r, isYOdd);\n\n  var rInv = signature$1.r.invm(n);\n  var s1 = n.sub(e).mul(rInv).umod(n);\n  var s2 = s.mul(rInv).umod(n);\n\n  // 1.6.1 Compute Q = r^-1 (sR -  eG)\n  //               Q = r^-1 (sR + -eG)\n  return this.g.mulAdd(s1, r, s2);\n};\n\nEC.prototype.getKeyRecoveryParam = function(e, signature$1, Q, enc) {\n  signature$1 = new signature(signature$1, enc);\n  if (signature$1.recoveryParam !== null)\n    return signature$1.recoveryParam;\n\n  for (var i = 0; i < 4; i++) {\n    var Qprime;\n    try {\n      Qprime = this.recoverPubKey(e, signature$1, i);\n    } catch (e) {\n      continue;\n    }\n\n    if (Qprime.eq(Q))\n      return i;\n  }\n  throw new Error('Unable to find valid recovery factor');\n};\n\nvar elliptic_1 = createCommonjsModule(function (module, exports) {\n'use strict';\n\nvar elliptic = exports;\n\nelliptic.version = /*RicMoo:ethers*/{ version: \"6.5.3\" }.version;\nelliptic.utils = utils_1$1;\nelliptic.rand = /*RicMoo:ethers:require(brorand)*/(function() { throw new Error('unsupported'); });\nelliptic.curve = curve_1;\nelliptic.curves = curves_1;\n\n// Protocols\nelliptic.ec = ec;\nelliptic.eddsa = /*RicMoo:ethers:require(./elliptic/eddsa)*/(null);\n});\n\nvar EC$1 = elliptic_1.ec;\n\nexport { EC$1 as EC };\n//# sourceMappingURL=browser-elliptic.js.map\n"]},"metadata":{},"sourceType":"module"}